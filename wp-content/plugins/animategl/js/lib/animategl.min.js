!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var s=e();for(var n in s)("object"==typeof exports?exports:t)[n]=s[n]}}(self,(function(){return(()=>{"use strict";var t={};function e(t,e,s){return t[0]=e[0]+s[0],t[1]=e[1]+s[1],t}function s(t,e,s){return t[0]=e[0]-s[0],t[1]=e[1]-s[1],t}function n(t,e,s){return t[0]=e[0]*s,t[1]=e[1]*s,t}function i(t){var e=t[0],s=t[1];return Math.sqrt(e*e+s*s)}function r(t,e){return t[0]*e[1]-t[1]*e[0]}(t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})})(t);class a extends Array{constructor(t=0,e=t){return super(t,e),this}get x(){return this[0]}get y(){return this[1]}set x(t){this[0]=t}set y(t){this[1]=t}set(t,e=t){return t.length?this.copy(t):(function(t,e,s){t[0]=e,t[1]=s}(this,t,e),this)}copy(t){var e,s;return s=t,(e=this)[0]=s[0],e[1]=s[1],this}add(t,s){return s?e(this,t,s):e(this,this,t),this}sub(t,e){return e?s(this,t,e):s(this,this,t),this}multiply(t){var e,s;return t.length?(this,s=t,(e=this)[0]=this[0]*s[0],e[1]=this[1]*s[1]):n(this,this,t),this}divide(t){var e,s;return t.length?(this,s=t,(e=this)[0]=this[0]/s[0],e[1]=this[1]/s[1]):n(this,this,1/t),this}inverse(t=this){var e,s;return s=t,(e=this)[0]=1/s[0],e[1]=1/s[1],this}len(){return i(this)}distance(t){return t?(this,s=(e=t)[0]-this[0],n=e[1]-this[1],Math.sqrt(s*s+n*n)):i(this);var e,s,n}squaredLen(){return this.squaredDistance()}squaredDistance(t){return t?(this,(s=(e=t)[0]-this[0])*s+(n=e[1]-this[1])*n):function(t){var e=t[0],s=t[1];return e*e+s*s}(this);var e,s,n}negate(t=this){var e,s;return s=t,(e=this)[0]=-s[0],e[1]=-s[1],this}cross(t,e){return e?r(t,e):r(this,t)}scale(t){return n(this,this,t),this}normalize(){var t,e,s,n;return this,(n=(e=(t=this)[0])*e+(s=t[1])*s)>0&&(n=1/Math.sqrt(n)),this[0]=t[0]*n,this[1]=t[1]*n,this}dot(t){return e=t,this[0]*e[0]+this[1]*e[1];var e}equals(t){return e=t,this[0]===e[0]&&this[1]===e[1];var e}applyMatrix3(t){var e,s,n;return this,e=t,s=this[0],n=this[1],this[0]=e[0]*s+e[3]*n+e[6],this[1]=e[1]*s+e[4]*n+e[7],this}applyMatrix4(t){return function(t,e,s){let n=e[0],i=e[1];t[0]=s[0]*n+s[4]*i+s[12],t[1]=s[1]*n+s[5]*i+s[13]}(this,this,t),this}lerp(t,e){return function(t,e,s,n){var i=e[0],r=e[1];t[0]=i+n*(s[0]-i),t[1]=r+n*(s[1]-r)}(this,this,t,e),this}clone(){return new a(this[0],this[1])}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t}}function o(t){let e=t[0],s=t[1],n=t[2];return Math.sqrt(e*e+s*s+n*n)}function h(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function l(t,e,s){return t[0]=e[0]+s[0],t[1]=e[1]+s[1],t[2]=e[2]+s[2],t}function u(t,e,s){return t[0]=e[0]-s[0],t[1]=e[1]-s[1],t[2]=e[2]-s[2],t}function c(t,e,s){return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function p(t){let e=t[0],s=t[1],n=t[2];return e*e+s*s+n*n}function d(t,e){let s=e[0],n=e[1],i=e[2],r=s*s+n*n+i*i;return r>0&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function f(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function m(t,e,s){let n=e[0],i=e[1],r=e[2],a=s[0],o=s[1],h=s[2];return t[0]=i*h-r*o,t[1]=r*a-n*h,t[2]=n*o-i*a,t}const g=function(){const t=[0,0,0],e=[0,0,0];return function(s,n){h(t,s),h(e,n),d(t,t),d(e,e);let i=f(t,e);return i>1?0:i<-1?Math.PI:Math.acos(i)}}();class v extends Array{constructor(t=0,e=t,s=t){return super(t,e,s),this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(t){this[0]=t}set y(t){this[1]=t}set z(t){this[2]=t}set(t,e=t,s=t){return t.length?this.copy(t):(function(t,e,s,n){t[0]=e,t[1]=s,t[2]=n}(this,t,e,s),this)}copy(t){return h(this,t),this}add(t,e){return e?l(this,t,e):l(this,this,t),this}sub(t,e){return e?u(this,t,e):u(this,this,t),this}multiply(t){var e,s,n;return t.length?(s=this,n=t,(e=this)[0]=s[0]*n[0],e[1]=s[1]*n[1],e[2]=s[2]*n[2]):c(this,this,t),this}divide(t){var e,s,n;return t.length?(s=this,n=t,(e=this)[0]=s[0]/n[0],e[1]=s[1]/n[1],e[2]=s[2]/n[2]):c(this,this,1/t),this}inverse(t=this){var e,s;return s=t,(e=this)[0]=1/s[0],e[1]=1/s[1],e[2]=1/s[2],this}len(){return o(this)}distance(t){return t?function(t,e){let s=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(s*s+n*n+i*i)}(this,t):o(this)}squaredLen(){return p(this)}squaredDistance(t){return t?function(t,e){let s=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return s*s+n*n+i*i}(this,t):p(this)}negate(t=this){var e,s;return s=t,(e=this)[0]=-s[0],e[1]=-s[1],e[2]=-s[2],this}cross(t,e){return e?m(this,t,e):m(this,this,t),this}scale(t){return c(this,this,t),this}normalize(){return d(this,this),this}dot(t){return f(this,t)}equals(t){return e=t,this[0]===e[0]&&this[1]===e[1]&&this[2]===e[2];var e}applyMatrix3(t){return function(t,e,s){let n=e[0],i=e[1],r=e[2];t[0]=n*s[0]+i*s[3]+r*s[6],t[1]=n*s[1]+i*s[4]+r*s[7],t[2]=n*s[2]+i*s[5]+r*s[8]}(this,this,t),this}applyMatrix4(t){return function(t,e,s){let n=e[0],i=e[1],r=e[2],a=s[3]*n+s[7]*i+s[11]*r+s[15];a=a||1,t[0]=(s[0]*n+s[4]*i+s[8]*r+s[12])/a,t[1]=(s[1]*n+s[5]*i+s[9]*r+s[13])/a,t[2]=(s[2]*n+s[6]*i+s[10]*r+s[14])/a}(this,this,t),this}scaleRotateMatrix4(t){return function(t,e,s){let n=e[0],i=e[1],r=e[2],a=s[3]*n+s[7]*i+s[11]*r+s[15];a=a||1,t[0]=(s[0]*n+s[4]*i+s[8]*r)/a,t[1]=(s[1]*n+s[5]*i+s[9]*r)/a,t[2]=(s[2]*n+s[6]*i+s[10]*r)/a}(this,this,t),this}applyQuaternion(t){return function(t,e,s){let n=e[0],i=e[1],r=e[2],a=s[0],o=s[1],h=s[2],l=o*r-h*i,u=h*n-a*r,c=a*i-o*n,p=o*c-h*u,d=h*l-a*c,f=a*u-o*l,m=2*s[3];l*=m,u*=m,c*=m,p*=2,d*=2,f*=2,t[0]=n+l+p,t[1]=i+u+d,t[2]=r+c+f}(this,this,t),this}angle(t){return g(this,t)}lerp(t,e){return function(t,e,s,n){let i=e[0],r=e[1],a=e[2];t[0]=i+n*(s[0]-i),t[1]=r+n*(s[1]-r),t[2]=a+n*(s[2]-a)}(this,this,t,e),this}clone(){return new v(this[0],this[1],this[2])}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t}transformDirection(t){const e=this[0],s=this[1],n=this[2];return this[0]=t[0]*e+t[4]*s+t[8]*n,this[1]=t[1]*e+t[5]*s+t[9]*n,this[2]=t[2]*e+t[6]*s+t[10]*n,this.normalize()}}const y=new v;let x=1;class b{constructor({canvas:t=document.createElement("canvas"),width:e=300,height:s=150,dpr:n=1,alpha:i=!1,depth:r=!0,stencil:a=!1,antialias:o=!1,premultipliedAlpha:h=!1,preserveDrawingBuffer:l=!1,powerPreference:u="default",autoClear:c=!0,webgl:p=2}={}){const d={alpha:i,depth:r,stencil:a,antialias:o,premultipliedAlpha:h,preserveDrawingBuffer:l,powerPreference:u};this.dpr=n,this.alpha=i,this.color=!0,this.depth=r,this.stencil=a,this.premultipliedAlpha=h,this.autoClear=c,this.id=x++,2===p&&(this.gl=t.getContext("webgl2",d)),this.isWebgl2=!!this.gl,this.gl||(this.gl=t.getContext("webgl",d)),this.gl||console.error("unable to create webgl context"),this.gl.renderer=this,this.setSize(e,s),this.state={},this.state.blendFunc={src:this.gl.ONE,dst:this.gl.ZERO},this.state.blendEquation={modeRGB:this.gl.FUNC_ADD},this.state.cullFace=null,this.state.frontFace=this.gl.CCW,this.state.depthMask=!0,this.state.depthFunc=this.gl.LESS,this.state.premultiplyAlpha=!1,this.state.flipY=!1,this.state.unpackAlignment=4,this.state.framebuffer=null,this.state.viewport={x:0,y:0,width:null,height:null},this.state.textureUnits=[],this.state.activeTextureUnit=0,this.state.boundBuffer=null,this.state.uniformLocations=new Map,this.extensions={},this.isWebgl2?(this.getExtension("EXT_color_buffer_float"),this.getExtension("OES_texture_float_linear")):(this.getExtension("OES_texture_float"),this.getExtension("OES_texture_float_linear"),this.getExtension("OES_texture_half_float"),this.getExtension("OES_texture_half_float_linear"),this.getExtension("OES_element_index_uint"),this.getExtension("OES_standard_derivatives"),this.getExtension("EXT_sRGB"),this.getExtension("WEBGL_depth_texture"),this.getExtension("WEBGL_draw_buffers")),this.getExtension("WEBGL_compressed_texture_astc"),this.getExtension("EXT_texture_compression_bptc"),this.getExtension("WEBGL_compressed_texture_s3tc"),this.getExtension("WEBGL_compressed_texture_etc1"),this.getExtension("WEBGL_compressed_texture_pvrtc"),this.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),this.drawBuffers=this.getExtension("WEBGL_draw_buffers","drawBuffers","drawBuffersWEBGL"),this.parameters={},this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.parameters.maxAnisotropy=this.getExtension("EXT_texture_filter_anisotropic")?this.gl.getParameter(this.getExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}setSize(t,e){this.width=t,this.height=e,this.gl.canvas.width=t*this.dpr,this.gl.canvas.height=e*this.dpr,Object.assign(this.gl.canvas.style,{width:t+"px",height:e+"px"})}setViewport(t,e,s=0,n=0){this.state.viewport.width===t&&this.state.viewport.height===e||(this.state.viewport.width=t,this.state.viewport.height=e,this.state.viewport.x=s,this.state.viewport.y=n,this.gl.viewport(s,n,t,e))}setScissor(t,e,s=0,n=0){this.gl.scissor(s,n,t,e)}enable(t){!0!==this.state[t]&&(this.gl.enable(t),this.state[t]=!0)}disable(t){!1!==this.state[t]&&(this.gl.disable(t),this.state[t]=!1)}setBlendFunc(t,e,s,n){this.state.blendFunc.src===t&&this.state.blendFunc.dst===e&&this.state.blendFunc.srcAlpha===s&&this.state.blendFunc.dstAlpha===n||(this.state.blendFunc.src=t,this.state.blendFunc.dst=e,this.state.blendFunc.srcAlpha=s,this.state.blendFunc.dstAlpha=n,void 0!==s?this.gl.blendFuncSeparate(t,e,s,n):this.gl.blendFunc(t,e))}setBlendEquation(t,e){t=t||this.gl.FUNC_ADD,this.state.blendEquation.modeRGB===t&&this.state.blendEquation.modeAlpha===e||(this.state.blendEquation.modeRGB=t,this.state.blendEquation.modeAlpha=e,void 0!==e?this.gl.blendEquationSeparate(t,e):this.gl.blendEquation(t))}setCullFace(t){this.state.cullFace!==t&&(this.state.cullFace=t,this.gl.cullFace(t))}setFrontFace(t){this.state.frontFace!==t&&(this.state.frontFace=t,this.gl.frontFace(t))}setDepthMask(t){this.state.depthMask!==t&&(this.state.depthMask=t,this.gl.depthMask(t))}setDepthFunc(t){this.state.depthFunc!==t&&(this.state.depthFunc=t,this.gl.depthFunc(t))}activeTexture(t){this.state.activeTextureUnit!==t&&(this.state.activeTextureUnit=t,this.gl.activeTexture(this.gl.TEXTURE0+t))}bindFramebuffer({target:t=this.gl.FRAMEBUFFER,buffer:e=null}={}){this.state.framebuffer!==e&&(this.state.framebuffer=e,this.gl.bindFramebuffer(t,e))}getExtension(t,e,s){return e&&this.gl[e]?this.gl[e].bind(this.gl):(this.extensions[t]||(this.extensions[t]=this.gl.getExtension(t)),e?this.extensions[t]?this.extensions[t][s].bind(this.extensions[t]):null:this.extensions[t])}sortOpaque(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:t.zDepth!==e.zDepth?t.zDepth-e.zDepth:e.id-t.id}sortTransparent(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.zDepth!==e.zDepth?e.zDepth-t.zDepth:e.id-t.id}sortUI(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:e.id-t.id}getRenderList({scene:t,camera:e,frustumCull:s,sort:n}){let i=[];if(e&&s&&e.updateFrustum(),t.traverse((t=>{if(!t.visible)return!0;t.draw&&(s&&t.frustumCulled&&e&&!e.frustumIntersectsMesh(t)||i.push(t))})),n){const t=[],s=[],n=[];i.forEach((i=>{i.program.transparent?i.program.depthTest?s.push(i):n.push(i):t.push(i),i.zDepth=0,0===i.renderOrder&&i.program.depthTest&&e&&(i.worldMatrix.getTranslation(y),y.applyMatrix4(e.projectionViewMatrix),i.zDepth=y.z)})),t.sort(this.sortOpaque),s.sort(this.sortTransparent),n.sort(this.sortUI),i=t.concat(s,n)}return i}render({scene:t,camera:e,target:s=null,update:n=!0,sort:i=!0,frustumCull:r=!0,clear:a}){null===s?(this.bindFramebuffer(),this.setViewport(this.width*this.dpr,this.height*this.dpr)):(this.bindFramebuffer(s),this.setViewport(s.width,s.height)),(a||this.autoClear&&!1!==a)&&(!this.depth||s&&!s.depth||(this.enable(this.gl.DEPTH_TEST),this.setDepthMask(!0)),this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))),n&&t.updateMatrixWorld(),e&&e.updateMatrixWorld(),this.getRenderList({scene:t,camera:e,frustumCull:r,sort:i}).forEach((t=>{t.draw({camera:e})}))}}function w(t,e,s){let n=e[0],i=e[1],r=e[2],a=e[3],o=s[0],h=s[1],l=s[2],u=s[3];return t[0]=n*u+a*o+i*l-r*h,t[1]=i*u+a*h+r*o-n*l,t[2]=r*u+a*l+n*h-i*o,t[3]=a*u-n*o-i*h-r*l,t}class M extends Array{constructor(t=0,e=0,s=0,n=1){return super(t,e,s,n),this.onChange=()=>{},this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(t){this[0]=t,this.onChange()}set y(t){this[1]=t,this.onChange()}set z(t){this[2]=t,this.onChange()}set w(t){this[3]=t,this.onChange()}identity(){var t;return(t=this)[0]=0,t[1]=0,t[2]=0,t[3]=1,this.onChange(),this}set(t,e,s,n){return t.length?this.copy(t):(function(t,e,s,n,i){t[0]=e,t[1]=s,t[2]=n,t[3]=i}(this,t,e,s,n),this.onChange(),this)}rotateX(t){return function(t,e,s){s*=.5;let n=e[0],i=e[1],r=e[2],a=e[3],o=Math.sin(s),h=Math.cos(s);t[0]=n*h+a*o,t[1]=i*h+r*o,t[2]=r*h-i*o,t[3]=a*h-n*o}(this,this,t),this.onChange(),this}rotateY(t){return function(t,e,s){s*=.5;let n=e[0],i=e[1],r=e[2],a=e[3],o=Math.sin(s),h=Math.cos(s);t[0]=n*h-r*o,t[1]=i*h+a*o,t[2]=r*h+n*o,t[3]=a*h-i*o}(this,this,t),this.onChange(),this}rotateZ(t){return function(t,e,s){s*=.5;let n=e[0],i=e[1],r=e[2],a=e[3],o=Math.sin(s),h=Math.cos(s);t[0]=n*h+i*o,t[1]=i*h-n*o,t[2]=r*h+a*o,t[3]=a*h-r*o}(this,this,t),this.onChange(),this}inverse(t=this){return function(t,e){let s=e[0],n=e[1],i=e[2],r=e[3],a=s*s+n*n+i*i+r*r,o=a?1/a:0;t[0]=-s*o,t[1]=-n*o,t[2]=-i*o,t[3]=r*o}(this,t),this.onChange(),this}conjugate(t=this){var e,s;return s=t,(e=this)[0]=-s[0],e[1]=-s[1],e[2]=-s[2],e[3]=s[3],this.onChange(),this}copy(t){return s=t,(e=this)[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],this.onChange(),this;var e,s}normalize(t=this){return function(t,e){let s=e[0],n=e[1],i=e[2],r=e[3],a=s*s+n*n+i*i+r*r;a>0&&(a=1/Math.sqrt(a)),t[0]=s*a,t[1]=n*a,t[2]=i*a,t[3]=r*a}(this,t),this.onChange(),this}multiply(t,e){return e?w(this,t,e):w(this,this,t),this.onChange(),this}dot(t){return s=t,(e=this)[0]*s[0]+e[1]*s[1]+e[2]*s[2]+e[3]*s[3];var e,s}fromMatrix3(t){return function(t,e){let s,n=e[0]+e[4]+e[8];if(n>0)s=Math.sqrt(n+1),t[3]=.5*s,s=.5/s,t[0]=(e[5]-e[7])*s,t[1]=(e[6]-e[2])*s,t[2]=(e[1]-e[3])*s;else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);let i=(n+1)%3,r=(n+2)%3;s=Math.sqrt(e[3*n+n]-e[3*i+i]-e[3*r+r]+1),t[n]=.5*s,s=.5/s,t[3]=(e[3*i+r]-e[3*r+i])*s,t[i]=(e[3*i+n]+e[3*n+i])*s,t[r]=(e[3*r+n]+e[3*n+r])*s}}(this,t),this.onChange(),this}fromEuler(t){return function(t,e,s="YXZ"){let n=Math.sin(.5*e[0]),i=Math.cos(.5*e[0]),r=Math.sin(.5*e[1]),a=Math.cos(.5*e[1]),o=Math.sin(.5*e[2]),h=Math.cos(.5*e[2]);"XYZ"===s?(t[0]=n*a*h+i*r*o,t[1]=i*r*h-n*a*o,t[2]=i*a*o+n*r*h,t[3]=i*a*h-n*r*o):"YXZ"===s?(t[0]=n*a*h+i*r*o,t[1]=i*r*h-n*a*o,t[2]=i*a*o-n*r*h,t[3]=i*a*h+n*r*o):"ZXY"===s?(t[0]=n*a*h-i*r*o,t[1]=i*r*h+n*a*o,t[2]=i*a*o+n*r*h,t[3]=i*a*h-n*r*o):"ZYX"===s?(t[0]=n*a*h-i*r*o,t[1]=i*r*h+n*a*o,t[2]=i*a*o-n*r*h,t[3]=i*a*h+n*r*o):"YZX"===s?(t[0]=n*a*h+i*r*o,t[1]=i*r*h+n*a*o,t[2]=i*a*o-n*r*h,t[3]=i*a*h-n*r*o):"XZY"===s&&(t[0]=n*a*h-i*r*o,t[1]=i*r*h-n*a*o,t[2]=i*a*o+n*r*h,t[3]=i*a*h+n*r*o)}(this,t,t.order),this}fromAxisAngle(t,e){return function(t,e,s){s*=.5;let n=Math.sin(s);t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(s)}(this,t,e),this}slerp(t,e){return function(t,e,s,n){let i,r,a,o,h,l=e[0],u=e[1],c=e[2],p=e[3],d=s[0],f=s[1],m=s[2],g=s[3];r=l*d+u*f+c*m+p*g,r<0&&(r=-r,d=-d,f=-f,m=-m,g=-g),1-r>1e-6?(i=Math.acos(r),a=Math.sin(i),o=Math.sin((1-n)*i)/a,h=Math.sin(n*i)/a):(o=1-n,h=n),t[0]=o*l+h*d,t[1]=o*u+h*f,t[2]=o*c+h*m,t[3]=o*p+h*g}(this,this,t,e),this}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this[3]=t[e+3],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t[e+3]=this[3],t}}function E(t,e,s){let n=e[0],i=e[1],r=e[2],a=e[3],o=e[4],h=e[5],l=e[6],u=e[7],c=e[8],p=e[9],d=e[10],f=e[11],m=e[12],g=e[13],v=e[14],y=e[15],x=s[0],b=s[1],w=s[2],M=s[3];return t[0]=x*n+b*o+w*c+M*m,t[1]=x*i+b*h+w*p+M*g,t[2]=x*r+b*l+w*d+M*v,t[3]=x*a+b*u+w*f+M*y,x=s[4],b=s[5],w=s[6],M=s[7],t[4]=x*n+b*o+w*c+M*m,t[5]=x*i+b*h+w*p+M*g,t[6]=x*r+b*l+w*d+M*v,t[7]=x*a+b*u+w*f+M*y,x=s[8],b=s[9],w=s[10],M=s[11],t[8]=x*n+b*o+w*c+M*m,t[9]=x*i+b*h+w*p+M*g,t[10]=x*r+b*l+w*d+M*v,t[11]=x*a+b*u+w*f+M*y,x=s[12],b=s[13],w=s[14],M=s[15],t[12]=x*n+b*o+w*c+M*m,t[13]=x*i+b*h+w*p+M*g,t[14]=x*r+b*l+w*d+M*v,t[15]=x*a+b*u+w*f+M*y,t}function A(t,e){let s=e[0],n=e[1],i=e[2],r=e[4],a=e[5],o=e[6],h=e[8],l=e[9],u=e[10];return t[0]=Math.hypot(s,n,i),t[1]=Math.hypot(r,a,o),t[2]=Math.hypot(h,l,u),t}const T=function(){const t=[0,0,0];return function(e,s){let n=t;A(n,s);let i=1/n[0],r=1/n[1],a=1/n[2],o=s[0]*i,h=s[1]*r,l=s[2]*a,u=s[4]*i,c=s[5]*r,p=s[6]*a,d=s[8]*i,f=s[9]*r,m=s[10]*a,g=o+c+m,v=0;return g>0?(v=2*Math.sqrt(g+1),e[3]=.25*v,e[0]=(p-f)/v,e[1]=(d-l)/v,e[2]=(h-u)/v):o>c&&o>m?(v=2*Math.sqrt(1+o-c-m),e[3]=(p-f)/v,e[0]=.25*v,e[1]=(h+u)/v,e[2]=(d+l)/v):c>m?(v=2*Math.sqrt(1+c-o-m),e[3]=(d-l)/v,e[0]=(h+u)/v,e[1]=.25*v,e[2]=(p+f)/v):(v=2*Math.sqrt(1+m-o-c),e[3]=(h-u)/v,e[0]=(d+l)/v,e[1]=(p+f)/v,e[2]=.25*v),e}}();class F extends Array{constructor(t=1,e=0,s=0,n=0,i=0,r=1,a=0,o=0,h=0,l=0,u=1,c=0,p=0,d=0,f=0,m=1){return super(t,e,s,n,i,r,a,o,h,l,u,c,p,d,f,m),this}get x(){return this[12]}get y(){return this[13]}get z(){return this[14]}get w(){return this[15]}set x(t){this[12]=t}set y(t){this[13]=t}set z(t){this[14]=t}set w(t){this[15]=t}set(t,e,s,n,i,r,a,o,h,l,u,c,p,d,f,m){return t.length?this.copy(t):(function(t,e,s,n,i,r,a,o,h,l,u,c,p,d,f,m,g){t[0]=e,t[1]=s,t[2]=n,t[3]=i,t[4]=r,t[5]=a,t[6]=o,t[7]=h,t[8]=l,t[9]=u,t[10]=c,t[11]=p,t[12]=d,t[13]=f,t[14]=m,t[15]=g}(this,t,e,s,n,i,r,a,o,h,l,u,c,p,d,f,m),this)}translate(t,e=this){return function(t,e,s){let n,i,r,a,o,h,l,u,c,p,d,f,m=s[0],g=s[1],v=s[2];e===t?(t[12]=e[0]*m+e[4]*g+e[8]*v+e[12],t[13]=e[1]*m+e[5]*g+e[9]*v+e[13],t[14]=e[2]*m+e[6]*g+e[10]*v+e[14],t[15]=e[3]*m+e[7]*g+e[11]*v+e[15]):(n=e[0],i=e[1],r=e[2],a=e[3],o=e[4],h=e[5],l=e[6],u=e[7],c=e[8],p=e[9],d=e[10],f=e[11],t[0]=n,t[1]=i,t[2]=r,t[3]=a,t[4]=o,t[5]=h,t[6]=l,t[7]=u,t[8]=c,t[9]=p,t[10]=d,t[11]=f,t[12]=n*m+o*g+c*v+e[12],t[13]=i*m+h*g+p*v+e[13],t[14]=r*m+l*g+d*v+e[14],t[15]=a*m+u*g+f*v+e[15])}(this,e,t),this}rotate(t,e,s=this){return function(t,e,s,n){let i,r,a,o,h,l,u,c,p,d,f,m,g,v,y,x,b,w,M,E,A,T,F,_,S=n[0],R=n[1],P=n[2],O=Math.hypot(S,R,P);Math.abs(O)<1e-6||(O=1/O,S*=O,R*=O,P*=O,i=Math.sin(s),r=Math.cos(s),a=1-r,o=e[0],h=e[1],l=e[2],u=e[3],c=e[4],p=e[5],d=e[6],f=e[7],m=e[8],g=e[9],v=e[10],y=e[11],x=S*S*a+r,b=R*S*a+P*i,w=P*S*a-R*i,M=S*R*a-P*i,E=R*R*a+r,A=P*R*a+S*i,T=S*P*a+R*i,F=R*P*a-S*i,_=P*P*a+r,t[0]=o*x+c*b+m*w,t[1]=h*x+p*b+g*w,t[2]=l*x+d*b+v*w,t[3]=u*x+f*b+y*w,t[4]=o*M+c*E+m*A,t[5]=h*M+p*E+g*A,t[6]=l*M+d*E+v*A,t[7]=u*M+f*E+y*A,t[8]=o*T+c*F+m*_,t[9]=h*T+p*F+g*_,t[10]=l*T+d*F+v*_,t[11]=u*T+f*F+y*_,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(this,s,t,e),this}scale(t,e=this){return function(t,e,s){let n=s[0],i=s[1],r=s[2];t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(this,e,"number"==typeof t?[t,t,t]:t),this}multiply(t,e){return e?E(this,t,e):E(this,this,t),this}identity(){var t;return(t=this)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}copy(t){var e,s;return s=t,(e=this)[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],e[9]=s[9],e[10]=s[10],e[11]=s[11],e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15],this}fromPerspective({fov:t,aspect:e,near:s,far:n}={}){return function(t,e,s,n,i){let r=1/Math.tan(e/2),a=1/(n-i);t[0]=r/s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+n)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*n*a,t[15]=0}(this,t,e,s,n),this}fromOrthogonal({left:t,right:e,bottom:s,top:n,near:i,far:r}){return function(t,e,s,n,i,r,a){let o=1/(e-s),h=1/(n-i),l=1/(r-a);t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+s)*o,t[13]=(i+n)*h,t[14]=(a+r)*l,t[15]=1}(this,t,e,s,n,i,r),this}fromQuaternion(t){return function(t,e){let s=e[0],n=e[1],i=e[2],r=e[3],a=s+s,o=n+n,h=i+i,l=s*a,u=n*a,c=n*o,p=i*a,d=i*o,f=i*h,m=r*a,g=r*o,v=r*h;t[0]=1-c-f,t[1]=u+v,t[2]=p-g,t[3]=0,t[4]=u-v,t[5]=1-l-f,t[6]=d+m,t[7]=0,t[8]=p+g,t[9]=d-m,t[10]=1-l-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this,t),this}setPosition(t){return this.x=t[0],this.y=t[1],this.z=t[2],this}inverse(t=this){return function(t,e){let s=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],h=e[6],l=e[7],u=e[8],c=e[9],p=e[10],d=e[11],f=e[12],m=e[13],g=e[14],v=e[15],y=s*o-n*a,x=s*h-i*a,b=s*l-r*a,w=n*h-i*o,M=n*l-r*o,E=i*l-r*h,A=u*m-c*f,T=u*g-p*f,F=u*v-d*f,_=c*g-p*m,S=c*v-d*m,R=p*v-d*g,P=y*R-x*S+b*_+w*F-M*T+E*A;P&&(P=1/P,t[0]=(o*R-h*S+l*_)*P,t[1]=(i*S-n*R-r*_)*P,t[2]=(m*E-g*M+v*w)*P,t[3]=(p*M-c*E-d*w)*P,t[4]=(h*F-a*R-l*T)*P,t[5]=(s*R-i*F+r*T)*P,t[6]=(g*b-f*E-v*x)*P,t[7]=(u*E-p*b+d*x)*P,t[8]=(a*S-o*F+l*A)*P,t[9]=(n*F-s*S-r*A)*P,t[10]=(f*M-m*b+v*y)*P,t[11]=(c*b-u*M-d*y)*P,t[12]=(o*T-a*_-h*A)*P,t[13]=(s*_-n*T+i*A)*P,t[14]=(m*x-f*w-g*y)*P,t[15]=(u*w-c*x+p*y)*P)}(this,t),this}compose(t,e,s){return function(t,e,s,n){let i=e[0],r=e[1],a=e[2],o=e[3],h=i+i,l=r+r,u=a+a,c=i*h,p=i*l,d=i*u,f=r*l,m=r*u,g=a*u,v=o*h,y=o*l,x=o*u,b=n[0],w=n[1],M=n[2];t[0]=(1-(f+g))*b,t[1]=(p+x)*b,t[2]=(d-y)*b,t[3]=0,t[4]=(p-x)*w,t[5]=(1-(c+g))*w,t[6]=(m+v)*w,t[7]=0,t[8]=(d+y)*M,t[9]=(m-v)*M,t[10]=(1-(c+f))*M,t[11]=0,t[12]=s[0],t[13]=s[1],t[14]=s[2],t[15]=1}(this,t,e,s),this}getRotation(t){return T(t,this),this}getTranslation(t){var e,s;return s=this,(e=t)[0]=s[12],e[1]=s[13],e[2]=s[14],this}getScaling(t){return A(t,this),this}getMaxScaleOnAxis(){return function(t){let e=t[0],s=t[1],n=t[2],i=t[4],r=t[5],a=t[6],o=t[8],h=t[9],l=t[10];const u=e*e+s*s+n*n,c=i*i+r*r+a*a,p=o*o+h*h+l*l;return Math.sqrt(Math.max(u,c,p))}(this)}lookAt(t,e,s){return function(t,e,s,n){let i=e[0],r=e[1],a=e[2],o=n[0],h=n[1],l=n[2],u=i-s[0],c=r-s[1],p=a-s[2],d=u*u+c*c+p*p;0===d?p=1:(d=1/Math.sqrt(d),u*=d,c*=d,p*=d);let f=h*p-l*c,m=l*u-o*p,g=o*c-h*u;d=f*f+m*m+g*g,0===d&&(l?o+=1e-6:h?l+=1e-6:h+=1e-6,f=h*p-l*c,m=l*u-o*p,g=o*c-h*u,d=f*f+m*m+g*g),d=1/Math.sqrt(d),f*=d,m*=d,g*=d,t[0]=f,t[1]=m,t[2]=g,t[3]=0,t[4]=c*g-p*m,t[5]=p*f-u*g,t[6]=u*m-c*f,t[7]=0,t[8]=u,t[9]=c,t[10]=p,t[11]=0,t[12]=i,t[13]=r,t[14]=a,t[15]=1}(this,t,e,s),this}determinant(){return function(t){let e=t[0],s=t[1],n=t[2],i=t[3],r=t[4],a=t[5],o=t[6],h=t[7],l=t[8],u=t[9],c=t[10],p=t[11],d=t[12],f=t[13],m=t[14],g=t[15];return(e*a-s*r)*(c*g-p*m)-(e*o-n*r)*(u*g-p*f)+(e*h-i*r)*(u*m-c*f)+(s*o-n*a)*(l*g-p*d)-(s*h-i*a)*(l*m-c*d)+(n*h-i*o)*(l*f-u*d)}(this)}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this[3]=t[e+3],this[4]=t[e+4],this[5]=t[e+5],this[6]=t[e+6],this[7]=t[e+7],this[8]=t[e+8],this[9]=t[e+9],this[10]=t[e+10],this[11]=t[e+11],this[12]=t[e+12],this[13]=t[e+13],this[14]=t[e+14],this[15]=t[e+15],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t[e+3]=this[3],t[e+4]=this[4],t[e+5]=this[5],t[e+6]=this[6],t[e+7]=this[7],t[e+8]=this[8],t[e+9]=this[9],t[e+10]=this[10],t[e+11]=this[11],t[e+12]=this[12],t[e+13]=this[13],t[e+14]=this[14],t[e+15]=this[15],t}}const _=new F;class S extends Array{constructor(t=0,e=t,s=t,n="YXZ"){return super(t,e,s),this.order=n,this.onChange=()=>{},this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(t){this[0]=t,this.onChange()}set y(t){this[1]=t,this.onChange()}set z(t){this[2]=t,this.onChange()}set(t,e=t,s=t){return t.length?this.copy(t):(this[0]=t,this[1]=e,this[2]=s,this.onChange(),this)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.onChange(),this}reorder(t){return this.order=t,this.onChange(),this}fromRotationMatrix(t,e=this.order){return function(t,e,s="YXZ"){"XYZ"===s?(t[1]=Math.asin(Math.min(Math.max(e[8],-1),1)),Math.abs(e[8])<.99999?(t[0]=Math.atan2(-e[9],e[10]),t[2]=Math.atan2(-e[4],e[0])):(t[0]=Math.atan2(e[6],e[5]),t[2]=0)):"YXZ"===s?(t[0]=Math.asin(-Math.min(Math.max(e[9],-1),1)),Math.abs(e[9])<.99999?(t[1]=Math.atan2(e[8],e[10]),t[2]=Math.atan2(e[1],e[5])):(t[1]=Math.atan2(-e[2],e[0]),t[2]=0)):"ZXY"===s?(t[0]=Math.asin(Math.min(Math.max(e[6],-1),1)),Math.abs(e[6])<.99999?(t[1]=Math.atan2(-e[2],e[10]),t[2]=Math.atan2(-e[4],e[5])):(t[1]=0,t[2]=Math.atan2(e[1],e[0]))):"ZYX"===s?(t[1]=Math.asin(-Math.min(Math.max(e[2],-1),1)),Math.abs(e[2])<.99999?(t[0]=Math.atan2(e[6],e[10]),t[2]=Math.atan2(e[1],e[0])):(t[0]=0,t[2]=Math.atan2(-e[4],e[5]))):"YZX"===s?(t[2]=Math.asin(Math.min(Math.max(e[1],-1),1)),Math.abs(e[1])<.99999?(t[0]=Math.atan2(-e[9],e[5]),t[1]=Math.atan2(-e[2],e[0])):(t[0]=0,t[1]=Math.atan2(e[8],e[10]))):"XZY"===s&&(t[2]=Math.asin(-Math.min(Math.max(e[4],-1),1)),Math.abs(e[4])<.99999?(t[0]=Math.atan2(e[6],e[5]),t[1]=Math.atan2(e[8],e[0])):(t[0]=Math.atan2(-e[9],e[10]),t[1]=0))}(this,t,e),this}fromQuaternion(t,e=this.order){return _.fromQuaternion(t),this.fromRotationMatrix(_,e)}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t}}class R{constructor(){this.parent=null,this.children=[],this.visible=!0,this.matrix=new F,this.worldMatrix=new F,this.matrixAutoUpdate=!0,this.position=new v,this.quaternion=new M,this.scale=new v(1),this.rotation=new S,this.up=new v(0,1,0),this.rotation.onChange=()=>this.quaternion.fromEuler(this.rotation),this.quaternion.onChange=()=>this.rotation.fromQuaternion(this.quaternion)}setParent(t,e=!0){this.parent&&t!==this.parent&&this.parent.removeChild(this,!1),this.parent=t,e&&t&&t.addChild(this,!1)}addChild(t,e=!0){~this.children.indexOf(t)||this.children.push(t),e&&t.setParent(this,!1)}removeChild(t,e=!0){~this.children.indexOf(t)&&this.children.splice(this.children.indexOf(t),1),e&&t.setParent(null,!1)}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||t)&&(null===this.parent?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,t=!0);for(let e=0,s=this.children.length;e<s;e++)this.children[e].updateMatrixWorld(t)}updateMatrix(){this.matrix.compose(this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0}traverse(t){if(!t(this))for(let e=0,s=this.children.length;e<s;e++)this.children[e].traverse(t)}decompose(){this.matrix.getTranslation(this.position),this.matrix.getRotation(this.quaternion),this.matrix.getScaling(this.scale),this.rotation.fromQuaternion(this.quaternion)}lookAt(t,e=!1){e?this.matrix.lookAt(this.position,t,this.up):this.matrix.lookAt(t,this.position,this.up),this.matrix.getRotation(this.quaternion),this.rotation.fromQuaternion(this.quaternion)}}const P=new F,O=new v,C=new v;class D extends R{constructor(t,{near:e=.1,far:s=100,fov:n=45,aspect:i=1,left:r,right:a,bottom:o,top:h,zoom:l=1}={}){super(),Object.assign(this,{near:e,far:s,fov:n,aspect:i,left:r,right:a,bottom:o,top:h,zoom:l}),this.projectionMatrix=new F,this.viewMatrix=new F,this.projectionViewMatrix=new F,this.worldPosition=new v,this.type=r||a?"orthographic":"perspective","orthographic"===this.type?this.orthographic():this.perspective()}perspective({near:t=this.near,far:e=this.far,fov:s=this.fov,aspect:n=this.aspect}={}){return Object.assign(this,{near:t,far:e,fov:s,aspect:n}),this.projectionMatrix.fromPerspective({fov:s*(Math.PI/180),aspect:n,near:t,far:e}),this.type="perspective",this}orthographic({near:t=this.near,far:e=this.far,left:s=this.left,right:n=this.right,bottom:i=this.bottom,top:r=this.top,zoom:a=this.zoom}={}){return Object.assign(this,{near:t,far:e,left:s,right:n,bottom:i,top:r,zoom:a}),s/=a,n/=a,i/=a,r/=a,this.projectionMatrix.fromOrthogonal({left:s,right:n,bottom:i,top:r,near:t,far:e}),this.type="orthographic",this}updateMatrixWorld(){return super.updateMatrixWorld(),this.viewMatrix.inverse(this.worldMatrix),this.worldMatrix.getTranslation(this.worldPosition),this.projectionViewMatrix.multiply(this.projectionMatrix,this.viewMatrix),this}lookAt(t){return super.lookAt(t,!0),this}project(t){return t.applyMatrix4(this.viewMatrix),t.applyMatrix4(this.projectionMatrix),this}unproject(t){return t.applyMatrix4(P.inverse(this.projectionMatrix)),t.applyMatrix4(this.worldMatrix),this}updateFrustum(){this.frustum||(this.frustum=[new v,new v,new v,new v,new v,new v]);const t=this.projectionViewMatrix;this.frustum[0].set(t[3]-t[0],t[7]-t[4],t[11]-t[8]).constant=t[15]-t[12],this.frustum[1].set(t[3]+t[0],t[7]+t[4],t[11]+t[8]).constant=t[15]+t[12],this.frustum[2].set(t[3]+t[1],t[7]+t[5],t[11]+t[9]).constant=t[15]+t[13],this.frustum[3].set(t[3]-t[1],t[7]-t[5],t[11]-t[9]).constant=t[15]-t[13],this.frustum[4].set(t[3]-t[2],t[7]-t[6],t[11]-t[10]).constant=t[15]-t[14],this.frustum[5].set(t[3]+t[2],t[7]+t[6],t[11]+t[10]).constant=t[15]+t[14];for(let t=0;t<6;t++){const e=1/this.frustum[t].distance();this.frustum[t].multiply(e),this.frustum[t].constant*=e}}frustumIntersectsMesh(t){if(!t.geometry.attributes.position)return!0;if(t.geometry.bounds&&t.geometry.bounds.radius!==1/0||t.geometry.computeBoundingSphere(),!t.geometry.bounds)return!0;const e=O;e.copy(t.geometry.bounds.center),e.applyMatrix4(t.worldMatrix);const s=t.geometry.bounds.radius*t.worldMatrix.getMaxScaleOnAxis();return this.frustumIntersectsSphere(e,s)}frustumIntersectsSphere(t,e){const s=C;for(let n=0;n<6;n++){const i=this.frustum[n];if(s.copy(i).dot(t)+i.constant<-e)return!1}return!0}}let I=1;const L={};class N{constructor(t,{vertex:e,fragment:s,uniforms:n={},transparent:i=!1,cullFace:r=t.BACK,frontFace:a=t.CCW,depthTest:o=!0,depthWrite:h=!0,depthFunc:l=t.LESS}={}){t.canvas||console.error("gl not passed as fist argument to Program"),this.gl=t,this.uniforms=n,this.id=I++,e||console.warn("vertex shader not supplied"),s||console.warn("fragment shader not supplied"),this.transparent=i,this.cullFace=r,this.frontFace=a,this.depthTest=o,this.depthWrite=h,this.depthFunc=l,this.blendFunc={},this.blendEquation={},this.transparent&&!this.blendFunc.src&&(this.gl.renderer.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA));const u=t.createShader(t.VERTEX_SHADER);t.shaderSource(u,e),t.compileShader(u),""!==t.getShaderInfoLog(u)&&console.warn(`${t.getShaderInfoLog(u)}\nVertex Shader\n${z(e)}`);const c=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(c,s),t.compileShader(c),""!==t.getShaderInfoLog(c)&&console.warn(`${t.getShaderInfoLog(c)}\nFragment Shader\n${z(s)}`),this.program=t.createProgram(),t.attachShader(this.program,u),t.attachShader(this.program,c),t.linkProgram(this.program),!t.getProgramParameter(this.program,t.LINK_STATUS))return console.warn(t.getProgramInfoLog(this.program));t.deleteShader(u),t.deleteShader(c),this.uniformLocations=new Map;let p=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS);for(let e=0;e<p;e++){let s=t.getActiveUniform(this.program,e);this.uniformLocations.set(s,t.getUniformLocation(this.program,s.name));const n=s.name.match(/(\w+)/g);s.uniformName=n[0],3===n.length?(s.isStructArray=!0,s.structIndex=Number(n[1]),s.structProperty=n[2]):2===n.length&&isNaN(Number(n[1]))&&(s.isStruct=!0,s.structProperty=n[1])}this.attributeLocations=new Map;const d=[],f=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES);for(let e=0;e<f;e++){const s=t.getActiveAttrib(this.program,e),n=t.getAttribLocation(this.program,s.name);d[n]=s.name,this.attributeLocations.set(s,n)}this.attributeOrder=d.join("")}setBlendFunc(t,e,s,n){this.blendFunc.src=t,this.blendFunc.dst=e,this.blendFunc.srcAlpha=s,this.blendFunc.dstAlpha=n,t&&(this.transparent=!0)}setBlendEquation(t,e){this.blendEquation.modeRGB=t,this.blendEquation.modeAlpha=e}applyState(){this.depthTest?this.gl.renderer.enable(this.gl.DEPTH_TEST):this.gl.renderer.disable(this.gl.DEPTH_TEST),this.cullFace?this.gl.renderer.enable(this.gl.CULL_FACE):this.gl.renderer.disable(this.gl.CULL_FACE),this.blendFunc.src?this.gl.renderer.enable(this.gl.BLEND):this.gl.renderer.disable(this.gl.BLEND),this.cullFace&&this.gl.renderer.setCullFace(this.cullFace),this.gl.renderer.setFrontFace(this.frontFace),this.gl.renderer.setDepthMask(this.depthWrite),this.gl.renderer.setDepthFunc(this.depthFunc),this.blendFunc.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha)}use({flipFaces:t=!1}={}){let e=-1;this.gl.renderer.currentProgram===this.id||(this.gl.useProgram(this.program),this.gl.renderer.currentProgram=this.id),this.uniformLocations.forEach(((t,s)=>{let n=s.uniformName,i=this.uniforms[n];if(s.isStruct&&(i=i[s.structProperty],n+=`.${s.structProperty}`),s.isStructArray&&(i=i[s.structIndex][s.structProperty],n+=`[${s.structIndex}].${s.structProperty}`),!i)return Y(`Active uniform ${n} has not been supplied`);if(i&&void 0===i.value)return Y(`${n} uniform is missing a value parameter`);if(i.value.texture)return e+=1,i.value.update(e),B(this.gl,s.type,t,e);if(i.value.length&&i.value[0].texture){const n=[];return i.value.forEach((t=>{e+=1,t.update(e),n.push(e)})),B(this.gl,s.type,t,n)}B(this.gl,s.type,t,i.value)})),this.applyState(),t&&this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)}remove(){this.gl.deleteProgram(this.program)}}function B(t,e,s,n){n=n.length?function(t){const e=t.length,s=t[0].length;if(void 0===s)return t;const n=e*s;let i=L[n];i||(L[n]=i=new Float32Array(n));for(let n=0;n<e;n++)i.set(t[n],n*s);return i}(n):n;const i=t.renderer.state.uniformLocations.get(s);if(n.length)if(void 0===i||i.length!==n.length)t.renderer.state.uniformLocations.set(s,n.slice(0));else{if(function(t,e){if(t.length!==e.length)return!1;for(let s=0,n=t.length;s<n;s++)if(t[s]!==e[s])return!1;return!0}(i,n))return;i.set?i.set(n):function(t,e){for(let s=0,n=t.length;s<n;s++)t[s]=e[s]}(i,n),t.renderer.state.uniformLocations.set(s,i)}else{if(i===n)return;t.renderer.state.uniformLocations.set(s,n)}switch(e){case 5126:return n.length?t.uniform1fv(s,n):t.uniform1f(s,n);case 35664:return t.uniform2fv(s,n);case 35665:return t.uniform3fv(s,n);case 35666:return t.uniform4fv(s,n);case 35670:case 5124:case 35678:case 35680:return n.length?t.uniform1iv(s,n):t.uniform1i(s,n);case 35671:case 35667:return t.uniform2iv(s,n);case 35672:case 35668:return t.uniform3iv(s,n);case 35673:case 35669:return t.uniform4iv(s,n);case 35674:return t.uniformMatrix2fv(s,!1,n);case 35675:return t.uniformMatrix3fv(s,!1,n);case 35676:return t.uniformMatrix4fv(s,!1,n)}}function z(t){let e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}let U=0;function Y(t){U>100||(console.warn(t),U++,U>100&&console.warn("More than 100 program warnings - stopping logs."))}function X(t,e,s){let n=e[0],i=e[1],r=e[2],a=e[3],o=e[4],h=e[5],l=e[6],u=e[7],c=e[8],p=s[0],d=s[1],f=s[2],m=s[3],g=s[4],v=s[5],y=s[6],x=s[7],b=s[8];return t[0]=p*n+d*a+f*l,t[1]=p*i+d*o+f*u,t[2]=p*r+d*h+f*c,t[3]=m*n+g*a+v*l,t[4]=m*i+g*o+v*u,t[5]=m*r+g*h+v*c,t[6]=y*n+x*a+b*l,t[7]=y*i+x*o+b*u,t[8]=y*r+x*h+b*c,t}class V extends Array{constructor(t=1,e=0,s=0,n=0,i=1,r=0,a=0,o=0,h=1){return super(t,e,s,n,i,r,a,o,h),this}set(t,e,s,n,i,r,a,o,h){return t.length?this.copy(t):(function(t,e,s,n,i,r,a,o,h,l){t[0]=e,t[1]=s,t[2]=n,t[3]=i,t[4]=r,t[5]=a,t[6]=o,t[7]=h,t[8]=l}(this,t,e,s,n,i,r,a,o,h),this)}translate(t,e=this){return function(t,e,s){let n=e[0],i=e[1],r=e[2],a=e[3],o=e[4],h=e[5],l=e[6],u=e[7],c=e[8],p=s[0],d=s[1];t[0]=n,t[1]=i,t[2]=r,t[3]=a,t[4]=o,t[5]=h,t[6]=p*n+d*a+l,t[7]=p*i+d*o+u,t[8]=p*r+d*h+c}(this,e,t),this}rotate(t,e=this){return function(t,e,s){let n=e[0],i=e[1],r=e[2],a=e[3],o=e[4],h=e[5],l=e[6],u=e[7],c=e[8],p=Math.sin(s),d=Math.cos(s);t[0]=d*n+p*a,t[1]=d*i+p*o,t[2]=d*r+p*h,t[3]=d*a-p*n,t[4]=d*o-p*i,t[5]=d*h-p*r,t[6]=l,t[7]=u,t[8]=c}(this,e,t),this}scale(t,e=this){return function(t,e,s){let n=s[0],i=s[1];t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8]}(this,e,t),this}multiply(t,e){return e?X(this,t,e):X(this,this,t),this}identity(){var t;return(t=this)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this}copy(t){var e,s;return s=t,(e=this)[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],this}fromMatrix4(t){var e,s;return s=t,(e=this)[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[4],e[4]=s[5],e[5]=s[6],e[6]=s[8],e[7]=s[9],e[8]=s[10],this}fromQuaternion(t){return function(t,e){let s=e[0],n=e[1],i=e[2],r=e[3],a=s+s,o=n+n,h=i+i,l=s*a,u=n*a,c=n*o,p=i*a,d=i*o,f=i*h,m=r*a,g=r*o,v=r*h;t[0]=1-c-f,t[3]=u-v,t[6]=p+g,t[1]=u+v,t[4]=1-l-f,t[7]=d-m,t[2]=p-g,t[5]=d+m,t[8]=1-l-c}(this,t),this}fromBasis(t,e,s){return this.set(t[0],t[1],t[2],e[0],e[1],e[2],s[0],s[1],s[2]),this}inverse(t=this){return function(t,e){let s=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],h=e[6],l=e[7],u=e[8],c=u*a-o*l,p=-u*r+o*h,d=l*r-a*h,f=s*c+n*p+i*d;f&&(f=1/f,t[0]=c*f,t[1]=(-u*n+i*l)*f,t[2]=(o*n-i*a)*f,t[3]=p*f,t[4]=(u*s-i*h)*f,t[5]=(-o*s+i*r)*f,t[6]=d*f,t[7]=(-l*s+n*h)*f,t[8]=(a*s-n*r)*f)}(this,t),this}getNormalMatrix(t){return function(t,e){let s=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],h=e[6],l=e[7],u=e[8],c=e[9],p=e[10],d=e[11],f=e[12],m=e[13],g=e[14],v=e[15],y=s*o-n*a,x=s*h-i*a,b=s*l-r*a,w=n*h-i*o,M=n*l-r*o,E=i*l-r*h,A=u*m-c*f,T=u*g-p*f,F=u*v-d*f,_=c*g-p*m,S=c*v-d*m,R=p*v-d*g,P=y*R-x*S+b*_+w*F-M*T+E*A;P&&(P=1/P,t[0]=(o*R-h*S+l*_)*P,t[1]=(h*F-a*R-l*T)*P,t[2]=(a*S-o*F+l*A)*P,t[3]=(i*S-n*R-r*_)*P,t[4]=(s*R-i*F+r*T)*P,t[5]=(n*F-s*S-r*A)*P,t[6]=(m*E-g*M+v*w)*P,t[7]=(g*b-f*E-v*x)*P,t[8]=(f*M-m*b+v*y)*P)}(this,t),this}}let q=0;class H extends R{constructor(t,{geometry:e,program:s,mode:n=t.TRIANGLES,frustumCulled:i=!0,renderOrder:r=0}={}){super(),t.canvas||console.error("gl not passed as first argument to Mesh"),this.gl=t,this.id=q++,this.geometry=e,this.program=s,this.mode=n,this.frustumCulled=i,this.renderOrder=r,this.modelViewMatrix=new F,this.normalMatrix=new V,this.beforeRenderCallbacks=[],this.afterRenderCallbacks=[]}onBeforeRender(t){return this.beforeRenderCallbacks.push(t),this}onAfterRender(t){return this.afterRenderCallbacks.push(t),this}draw({camera:t}={}){this.beforeRenderCallbacks.forEach((e=>e&&e({mesh:this,camera:t}))),t&&(this.program.uniforms.modelMatrix||Object.assign(this.program.uniforms,{modelMatrix:{value:null},viewMatrix:{value:null},modelViewMatrix:{value:null},normalMatrix:{value:null},projectionMatrix:{value:null},cameraPosition:{value:null}}),this.program.uniforms.projectionMatrix.value=t.projectionMatrix,this.program.uniforms.cameraPosition.value=t.worldPosition,this.program.uniforms.viewMatrix.value=t.viewMatrix,this.modelViewMatrix.multiply(t.viewMatrix,this.worldMatrix),this.normalMatrix.getNormalMatrix(this.modelViewMatrix),this.program.uniforms.modelMatrix.value=this.worldMatrix,this.program.uniforms.modelViewMatrix.value=this.modelViewMatrix,this.program.uniforms.normalMatrix.value=this.normalMatrix);let e=this.program.cullFace&&this.worldMatrix.determinant()<0;this.program.use({flipFaces:e}),this.geometry.draw({mode:this.mode,program:this.program}),this.afterRenderCallbacks.forEach((e=>e&&e({mesh:this,camera:t})))}}const k=new Uint8Array(4);function G(t){return 0==(t&t-1)}let W=1;class j{constructor(t,{image:e,target:s=t.TEXTURE_2D,type:n=t.UNSIGNED_BYTE,format:i=t.RGBA,internalFormat:r=i,wrapS:a=t.CLAMP_TO_EDGE,wrapT:o=t.CLAMP_TO_EDGE,generateMipmaps:h=!0,minFilter:l=(h?t.NEAREST_MIPMAP_LINEAR:t.LINEAR),magFilter:u=t.LINEAR,premultiplyAlpha:c=!1,unpackAlignment:p=4,flipY:d=s==t.TEXTURE_2D,anisotropy:f=0,level:m=0,width:g,height:v=g}={}){this.gl=t,this.id=W++,this.image=e,this.target=s,this.type=n,this.format=i,this.internalFormat=r,this.minFilter=l,this.magFilter=u,this.wrapS=a,this.wrapT=o,this.generateMipmaps=h,this.premultiplyAlpha=c,this.unpackAlignment=p,this.flipY=d,this.anisotropy=Math.min(f,this.gl.renderer.parameters.maxAnisotropy),this.level=m,this.width=g,this.height=v,this.texture=this.gl.createTexture(),this.store={image:null},this.glState=this.gl.renderer.state,this.state={},this.state.minFilter=this.gl.NEAREST_MIPMAP_LINEAR,this.state.magFilter=this.gl.LINEAR,this.state.wrapS=this.gl.REPEAT,this.state.wrapT=this.gl.REPEAT,this.state.anisotropy=0}bind(){this.glState.textureUnits[this.glState.activeTextureUnit]!==this.id&&(this.gl.bindTexture(this.target,this.texture),this.glState.textureUnits[this.glState.activeTextureUnit]=this.id)}update(t=0){const e=!(this.image===this.store.image&&!this.needsUpdate);if((e||this.glState.textureUnits[t]!==this.id)&&(this.gl.renderer.activeTexture(t),this.bind()),e){if(this.needsUpdate=!1,this.flipY!==this.glState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.flipY),this.glState.flipY=this.flipY),this.premultiplyAlpha!==this.glState.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.glState.premultiplyAlpha=this.premultiplyAlpha),this.unpackAlignment!==this.glState.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.unpackAlignment),this.glState.unpackAlignment=this.unpackAlignment),this.minFilter!==this.state.minFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.minFilter),this.state.minFilter=this.minFilter),this.magFilter!==this.state.magFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.magFilter),this.state.magFilter=this.magFilter),this.wrapS!==this.state.wrapS&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.wrapS),this.state.wrapS=this.wrapS),this.wrapT!==this.state.wrapT&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.wrapT),this.state.wrapT=this.wrapT),this.anisotropy&&this.anisotropy!==this.state.anisotropy&&(this.gl.texParameterf(this.target,this.gl.renderer.getExtension("EXT_texture_filter_anisotropic").TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropy),this.state.anisotropy=this.anisotropy),this.image){if(this.image.width&&(this.width=this.image.width,this.height=this.image.height),this.target===this.gl.TEXTURE_CUBE_MAP)for(let t=0;t<6;t++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+t,this.level,this.internalFormat,this.format,this.type,this.image[t]);else if(ArrayBuffer.isView(this.image))this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,this.image);else if(this.image.isCompressedTexture)for(let t=0;t<this.image.length;t++)this.gl.compressedTexImage2D(this.target,t,this.internalFormat,this.image[t].width,this.image[t].height,0,this.image[t].data);else this.gl.texImage2D(this.target,this.level,this.internalFormat,this.format,this.type,this.image);this.generateMipmaps&&(this.gl.renderer.isWebgl2||G(this.image.width)&&G(this.image.height)?this.gl.generateMipmap(this.target):(this.generateMipmaps=!1,this.wrapS=this.wrapT=this.gl.CLAMP_TO_EDGE,this.minFilter=this.gl.LINEAR)),this.onUpdate&&this.onUpdate()}else if(this.target===this.gl.TEXTURE_CUBE_MAP)for(let t=0;t<6;t++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,k);else this.width?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,null):this.gl.texImage2D(this.target,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,k);this.store.image=this.image}}}class Z{constructor(t,{width:e=t.canvas.width,height:s=t.canvas.height,target:n=t.FRAMEBUFFER,color:i=1,depth:r=!0,stencil:a=!1,depthTexture:o=!1,wrapS:h=t.CLAMP_TO_EDGE,wrapT:l=t.CLAMP_TO_EDGE,minFilter:u=t.LINEAR,magFilter:c=u,type:p=t.UNSIGNED_BYTE,format:d=t.RGBA,internalFormat:f=d,unpackAlignment:m,premultiplyAlpha:g}={}){this.gl=t,this.width=e,this.height=s,this.depth=r,this.buffer=this.gl.createFramebuffer(),this.target=n,this.gl.bindFramebuffer(this.target,this.buffer),this.textures=[];const v=[];for(let n=0;n<i;n++)this.textures.push(new j(t,{width:e,height:s,wrapS:h,wrapT:l,minFilter:u,magFilter:c,type:p,format:d,internalFormat:f,unpackAlignment:m,premultiplyAlpha:g,flipY:!1,generateMipmaps:!1})),this.textures[n].update(),this.gl.framebufferTexture2D(this.target,this.gl.COLOR_ATTACHMENT0+n,this.gl.TEXTURE_2D,this.textures[n].texture,0),v.push(this.gl.COLOR_ATTACHMENT0+n);v.length>1&&this.gl.renderer.drawBuffers(v),this.texture=this.textures[0],o&&(this.gl.renderer.isWebgl2||this.gl.renderer.getExtension("WEBGL_depth_texture"))?(this.depthTexture=new j(t,{width:e,height:s,minFilter:this.gl.NEAREST,magFilter:this.gl.NEAREST,format:this.gl.DEPTH_COMPONENT,internalFormat:t.renderer.isWebgl2?this.gl.DEPTH_COMPONENT16:this.gl.DEPTH_COMPONENT,type:this.gl.UNSIGNED_INT}),this.depthTexture.update(),this.gl.framebufferTexture2D(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.TEXTURE_2D,this.depthTexture.texture,0)):(r&&!a&&(this.depthBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,e,s),this.gl.framebufferRenderbuffer(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,this.depthBuffer)),a&&!r&&(this.stencilBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.stencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.STENCIL_INDEX8,e,s),this.gl.framebufferRenderbuffer(this.target,this.gl.STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.stencilBuffer)),r&&a&&(this.depthStencilBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthStencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_STENCIL,e,s),this.gl.framebufferRenderbuffer(this.target,this.gl.DEPTH_STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.depthStencilBuffer))),this.gl.bindFramebuffer(this.target,null)}setSize(t,e){if(this.width!==t||this.height!==e){this.width=t,this.height=e,this.gl.bindFramebuffer(this.target,this.buffer);for(let s=0;s<this.textures.length;s++)this.textures[s].width=t,this.textures[s].height=e,this.textures[s].needsUpdate=!0,this.textures[s].update(),this.gl.framebufferTexture2D(this.target,this.gl.COLOR_ATTACHMENT0+s,this.gl.TEXTURE_2D,this.textures[s].texture,0);this.depthTexture?(this.depthTexture.width=t,this.depthTexture.height=e,this.depthTexture.needsUpdate=!0,this.depthTexture.update(),this.gl.framebufferTexture2D(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.TEXTURE_2D,this.depthTexture.texture,0)):(this.depthBuffer&&(this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,t,e)),this.stencilBuffer&&(this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.stencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.STENCIL_INDEX8,t,e)),this.depthStencilBuffer&&(this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthStencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_STENCIL,t,e))),this.gl.bindFramebuffer(this.target,null)}}}const $=new v;let Q=1,J=1,K=!1;class tt{constructor(t,e={}){t.canvas||console.error("gl not passed as first argument to Geometry"),this.gl=t,this.attributes=e,this.id=Q++,this.VAOs={},this.drawRange={start:0,count:0},this.instancedCount=0,this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry=null,this.glState=this.gl.renderer.state;for(let t in e)this.addAttribute(t,e[t])}addAttribute(t,e){if(this.attributes[t]=e,e.id=J++,e.size=e.size||1,e.type=e.type||(e.data.constructor===Float32Array?this.gl.FLOAT:e.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT),e.target="index"===t?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,e.normalized=e.normalized||!1,e.stride=e.stride||0,e.offset=e.offset||0,e.count=e.count||(e.stride?e.data.byteLength/e.stride:e.data.length/e.size),e.divisor=e.instanced||0,e.needsUpdate=!1,e.usage=e.usage||this.gl.STATIC_DRAW,e.buffer||this.updateAttribute(e),e.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==e.count*e.divisor)return console.warn("geometry has multiple instanced buffers of different length"),this.instancedCount=Math.min(this.instancedCount,e.count*e.divisor);this.instancedCount=e.count*e.divisor}else"index"===t?this.drawRange.count=e.count:this.attributes.index||(this.drawRange.count=Math.max(this.drawRange.count,e.count))}updateAttribute(t){const e=!t.buffer;e&&(t.buffer=this.gl.createBuffer()),this.glState.boundBuffer!==t.buffer&&(this.gl.bindBuffer(t.target,t.buffer),this.glState.boundBuffer=t.buffer),e?this.gl.bufferData(t.target,t.data,t.usage):this.gl.bufferSubData(t.target,0,t.data),t.needsUpdate=!1}setIndex(t){this.addAttribute("index",t)}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}setInstancedCount(t){this.instancedCount=t}createVAO(t){this.VAOs[t.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.bindAttributes(t)}bindAttributes(t){t.attributeLocations.forEach(((t,{name:e,type:s})=>{if(!this.attributes[e])return void console.warn(`active attribute ${e} not being supplied`);const n=this.attributes[e];this.gl.bindBuffer(n.target,n.buffer),this.glState.boundBuffer=n.buffer;let i=1;35674===s&&(i=2),35675===s&&(i=3),35676===s&&(i=4);const r=n.size/i,a=1===i?0:i*i*i,o=1===i?0:i*i;for(let e=0;e<i;e++)this.gl.vertexAttribPointer(t+e,r,n.type,n.normalized,n.stride+a,n.offset+e*o),this.gl.enableVertexAttribArray(t+e),this.gl.renderer.vertexAttribDivisor(t+e,n.divisor)})),this.attributes.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}draw({program:t,mode:e=this.gl.TRIANGLES}){this.gl.renderer.currentGeometry!==`${this.id}_${t.attributeOrder}`&&(this.VAOs[t.attributeOrder]||this.createVAO(t),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.gl.renderer.currentGeometry=`${this.id}_${t.attributeOrder}`),t.attributeLocations.forEach(((t,{name:e})=>{const s=this.attributes[e];s.needsUpdate&&this.updateAttribute(s)})),this.isInstanced?this.attributes.index?this.gl.renderer.drawElementsInstanced(e,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+2*this.drawRange.start,this.instancedCount):this.gl.renderer.drawArraysInstanced(e,this.drawRange.start,this.drawRange.count,this.instancedCount):this.attributes.index?this.gl.drawElements(e,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+2*this.drawRange.start):this.gl.drawArrays(e,this.drawRange.start,this.drawRange.count)}getPosition(){const t=this.attributes.position;return t.data?t:K?void 0:(console.warn("No position buffer data found to compute bounds"),K=!0)}computeBoundingBox(t){t||(t=this.getPosition());const e=t.data,s=t.stride?t.stride/e.BYTES_PER_ELEMENT:t.size;this.bounds||(this.bounds={min:new v,max:new v,center:new v,scale:new v,radius:1/0});const n=this.bounds.min,i=this.bounds.max,r=this.bounds.center,a=this.bounds.scale;n.set(1/0),i.set(-1/0);for(let t=0,r=e.length;t<r;t+=s){const s=e[t],r=e[t+1],a=e[t+2];n.x=Math.min(s,n.x),n.y=Math.min(r,n.y),n.z=Math.min(a,n.z),i.x=Math.max(s,i.x),i.y=Math.max(r,i.y),i.z=Math.max(a,i.z)}a.sub(i,n),r.add(n,i).divide(2)}computeBoundingSphere(t){t||(t=this.getPosition());const e=t.data,s=t.stride?t.stride/e.BYTES_PER_ELEMENT:t.size;this.bounds||this.computeBoundingBox(t);let n=0;for(let t=0,i=e.length;t<i;t+=s)$.fromArray(e,t),n=Math.max(n,this.bounds.center.squaredDistance($));this.bounds.radius=Math.sqrt(n)}remove(){for(let t in this.VAOs)this.gl.renderer.deleteVertexArray(this.VAOs[t]),delete this.VAOs[t];for(let t in this.attributes)this.gl.deleteBuffer(this.attributes[t].buffer),delete this.attributes[t]}}class et extends tt{constructor(t,{attributes:e={}}={}){Object.assign(e,{position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}}),super(t,e)}}class st{constructor(t,{width:e,height:s,dpr:n,wrapS:i=t.CLAMP_TO_EDGE,wrapT:r=t.CLAMP_TO_EDGE,minFilter:a=t.LINEAR,magFilter:o=t.LINEAR,geometry:h=new et(t),targetOnly:l=null}={}){this.gl=t,this.options={wrapS:i,wrapT:r,minFilter:a,magFilter:o},this.passes=[],this.geometry=h,this.uniform={value:null},this.targetOnly=l;const u=this.fbo={read:null,write:null,swap:()=>{let t=u.read;u.read=u.write,u.write=t}};this.resize({width:e,height:s,dpr:n})}addPass({vertex:t=nt,fragment:e=it,uniforms:s={},textureUniform:n="tMap",enabled:i=!0}={}){s[n]={value:this.fbo.read.texture};const r=new N(this.gl,{vertex:t,fragment:e,uniforms:s}),a={mesh:new H(this.gl,{geometry:this.geometry,program:r}),program:r,uniforms:s,enabled:i,textureUniform:n};return this.passes.push(a),a}resize({width:t,height:e,dpr:s}={}){s&&(this.dpr=s),t&&(this.width=t,this.height=e||t),s=this.dpr||this.gl.renderer.dpr,t=Math.floor((this.width||this.gl.renderer.width)*s),e=Math.floor((this.height||this.gl.renderer.height)*s),this.options.width=t,this.options.height=e,this.fbo.read=new Z(this.gl,this.options),this.fbo.write=new Z(this.gl,this.options)}render({scene:t,camera:e,texture:s,target:n=null,update:i=!0,sort:r=!0,frustumCull:a=!0}){const o=this.passes.filter((t=>t.enabled));s||(this.gl.renderer.render({scene:t,camera:e,target:o.length||!n&&this.targetOnly?this.fbo.write:n,update:i,sort:r,frustumCull:a}),this.fbo.swap()),o.forEach(((t,e)=>{t.mesh.program.uniforms[t.textureUniform].value=!e&&s?s:this.fbo.read.texture,this.gl.renderer.render({scene:t.mesh,target:e!==o.length-1||!n&&this.targetOnly?this.fbo.write:n,clear:!0}),this.fbo.swap()})),this.uniform.value=this.fbo.read.texture}}const nt="\n    attribute vec2 uv;\n    attribute vec2 position;\n\n    varying vec2 vUv;\n\n    void main() {\n        vUv = uv;\n        gl_Position = vec4(position, 0, 1);\n    }\n",it="\n    precision highp float;\n\n    uniform sampler2D tMap;\n    varying vec2 vUv;\n\n    void main() {\n        gl_FragColor = texture2D(tMap, vUv);\n    }\n";class rt{constructor(t,{size:e=128,falloff:s=.3,alpha:n=1,dissipation:i=.98,type:r}={}){const o=this;this.gl=t,this.uniform={value:null},this.mask={read:null,write:null,swap:()=>{let t=o.mask.read;o.mask.read=o.mask.write,o.mask.write=t,o.uniform.value=o.mask.read.texture}},function(){r||(r=t.HALF_FLOAT||t.renderer.extensions.OES_texture_half_float.HALF_FLOAT_OES);let s=t.renderer.isWebgl2||t.renderer.extensions[`OES_texture_${r===t.FLOAT?"":"half_"}float_linear`]?t.LINEAR:t.NEAREST;const n={width:e,height:e,type:r,format:t.RGBA,internalFormat:t.renderer.isWebgl2?r===t.FLOAT?t.RGBA32F:t.RGBA16F:t.RGBA,minFilter:s,depth:!1};o.mask.read=new Z(t,n),o.mask.write=new Z(t,n),o.mask.swap()}(),this.aspect=1,this.mouse=new a,this.velocity=new a,this.mesh=new H(t,{geometry:new et(t),program:new N(t,{vertex:at,fragment:ot,uniforms:{tMap:o.uniform,uFalloff:{value:.5*s},uAlpha:{value:n},uDissipation:{value:i},uAspect:{value:1},uMouse:{value:o.mouse},uVelocity:{value:o.velocity}},depthTest:!1})})}update(){this.mesh.program.uniforms.uAspect.value=this.aspect,this.gl.renderer.render({scene:this.mesh,target:this.mask.write,clear:!1}),this.mask.swap()}}const at="\n    attribute vec2 uv;\n    attribute vec2 position;\n\n    varying vec2 vUv;\n\n    void main() {\n        vUv = uv;\n        gl_Position = vec4(position, 0, 1);\n    }\n",ot="\n    precision highp float;\n\n    uniform sampler2D tMap;\n\n    uniform float uFalloff;\n    uniform float uAlpha;\n    uniform float uDissipation;\n    \n    uniform float uAspect;\n    uniform vec2 uMouse;\n    uniform vec2 uVelocity;\n\n    varying vec2 vUv;\n\n    void main() {\n        vec4 color = texture2D(tMap, vUv) * uDissipation;\n\n        vec2 cursor = vUv - uMouse;\n        cursor.x *= uAspect;\n\n        vec3 stamp = vec3(uVelocity * vec2(1, -1), 1.0 - pow(1.0 - min(1.0, length(uVelocity)), 3.0));\n        float falloff = smoothstep(uFalloff, 0.0, length(cursor)) * uAlpha;\n\n        color.rgb = mix(color.rgb, stamp, vec3(falloff));\n\n        gl_FragColor = color;\n    }\n";class ht extends tt{constructor(t,{width:e=1,height:s=1,widthSegments:n=1,heightSegments:i=1,attributes:r={}}={}){const a=n,o=i,h=(a+1)*(o+1),l=a*o*6,u=new Float32Array(3*h),c=new Float32Array(3*h),p=new Float32Array(2*h),d=l>65536?new Uint32Array(l):new Uint16Array(l);ht.buildPlane(u,c,p,d,e,s,0,a,o),Object.assign(r,{position:{size:3,data:u},normal:{size:3,data:c},uv:{size:2,data:p},index:{data:d}}),super(t,r)}static buildPlane(t,e,s,n,i,r,a,o,h,l=0,u=1,c=2,p=1,d=-1,f=0,m=0){const g=f,v=i/o,y=r/h;for(let x=0;x<=h;x++){let b=x*y-r/2;for(let r=0;r<=o;r++,f++){let y=r*v-i/2;if(t[3*f+l]=y*p,t[3*f+u]=b*d,t[3*f+c]=a/2,e[3*f+l]=0,e[3*f+u]=0,e[3*f+c]=a>=0?1:-1,s[2*f]=r/o,s[2*f+1]=1-x/h,x===h||r===o)continue;let w=g+r+x*(o+1),M=g+r+(x+1)*(o+1),E=g+r+(x+1)*(o+1)+1,A=g+r+x*(o+1)+1;n[6*m]=w,n[6*m+1]=M,n[6*m+2]=A,n[6*m+3]=M,n[6*m+4]=E,n[6*m+5]=A,m++}}}}var lt={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0},ut={duration:1e3,delay:0,endDelay:0,easing:"easeOutElastic(1, .5)",round:0},ct=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],pt={CSS:{},springs:{}};function dt(t,e,s){return Math.min(Math.max(t,e),s)}function ft(t,e){return t.indexOf(e)>-1}function mt(t,e){return t.apply(null,e)}var gt={arr:function(t){return Array.isArray(t)},obj:function(t){return ft(Object.prototype.toString.call(t),"Object")},pth:function(t){return gt.obj(t)&&t.hasOwnProperty("totalLength")},svg:function(t){return t instanceof SVGElement},inp:function(t){return t instanceof HTMLInputElement},dom:function(t){return t.nodeType||gt.svg(t)},str:function(t){return"string"==typeof t},fnc:function(t){return"function"==typeof t},und:function(t){return void 0===t},nil:function(t){return gt.und(t)||null===t},hex:function(t){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t)},rgb:function(t){return/^rgb/.test(t)},hsl:function(t){return/^hsl/.test(t)},col:function(t){return gt.hex(t)||gt.rgb(t)||gt.hsl(t)},key:function(t){return!lt.hasOwnProperty(t)&&!ut.hasOwnProperty(t)&&"targets"!==t&&"keyframes"!==t}};function vt(t){var e=/\(([^)]+)\)/.exec(t);return e?e[1].split(",").map((function(t){return parseFloat(t)})):[]}function yt(t,e){var s=vt(t),n=dt(gt.und(s[0])?1:s[0],.1,100),i=dt(gt.und(s[1])?100:s[1],.1,100),r=dt(gt.und(s[2])?10:s[2],.1,100),a=dt(gt.und(s[3])?0:s[3],.1,100),o=Math.sqrt(i/n),h=r/(2*Math.sqrt(i*n)),l=h<1?o*Math.sqrt(1-h*h):0,u=h<1?(h*o-a)/l:-a+o;function c(t){var s=e?e*t/1e3:t;return s=h<1?Math.exp(-s*h*o)*(1*Math.cos(l*s)+u*Math.sin(l*s)):(1+u*s)*Math.exp(-s*o),0===t||1===t?t:1-s}return e?c:function(){var e=pt.springs[t];if(e)return e;for(var s=1/6,n=0,i=0;;)if(1===c(n+=s)){if(++i>=16)break}else i=0;var r=n*s*1e3;return pt.springs[t]=r,r}}function xt(t){return void 0===t&&(t=10),function(e){return Math.ceil(dt(e,1e-6,1)*t)*(1/t)}}var bt,wt,Mt=function(){var t=.1;function e(t,e){return 1-3*e+3*t}function s(t,e){return 3*e-6*t}function n(t){return 3*t}function i(t,i,r){return((e(i,r)*t+s(i,r))*t+n(i))*t}function r(t,i,r){return 3*e(i,r)*t*t+2*s(i,r)*t+n(i)}return function(e,s,n,a){if(0<=e&&e<=1&&0<=n&&n<=1){var o=new Float32Array(11);if(e!==s||n!==a)for(var h=0;h<11;++h)o[h]=i(h*t,e,n);return function(h){return e===s&&n===a||0===h||1===h?h:i(function(s){for(var a=0,h=1;10!==h&&o[h]<=s;++h)a+=t;--h;var l=a+(s-o[h])/(o[h+1]-o[h])*t,u=r(l,e,n);return u>=.001?function(t,e,s,n){for(var a=0;a<4;++a){var o=r(e,s,n);if(0===o)return e;e-=(i(e,s,n)-t)/o}return e}(s,l,e,n):0===u?l:function(t,e,s,n,r){var a,o,h=0;do{(a=i(o=e+(s-e)/2,n,r)-t)>0?s=o:e=o}while(Math.abs(a)>1e-7&&++h<10);return o}(s,a,a+t,e,n)}(h),s,a)}}}}(),Et=(bt={linear:function(){return function(t){return t}}},wt={Sine:function(){return function(t){return 1-Math.cos(t*Math.PI/2)}},Circ:function(){return function(t){return 1-Math.sqrt(1-t*t)}},Back:function(){return function(t){return t*t*(3*t-2)}},Bounce:function(){return function(t){for(var e,s=4;t<((e=Math.pow(2,--s))-1)/11;);return 1/Math.pow(4,3-s)-7.5625*Math.pow((3*e-2)/22-t,2)}},Elastic:function(t,e){void 0===t&&(t=1),void 0===e&&(e=.5);var s=dt(t,1,10),n=dt(e,.1,2);return function(t){return 0===t||1===t?t:-s*Math.pow(2,10*(t-1))*Math.sin((t-1-n/(2*Math.PI)*Math.asin(1/s))*(2*Math.PI)/n)}}},["Quad","Cubic","Quart","Quint","Expo"].forEach((function(t,e){wt[t]=function(){return function(t){return Math.pow(t,e+2)}}})),Object.keys(wt).forEach((function(t){var e=wt[t];bt["easeIn"+t]=e,bt["easeOut"+t]=function(t,s){return function(n){return 1-e(t,s)(1-n)}},bt["easeInOut"+t]=function(t,s){return function(n){return n<.5?e(t,s)(2*n)/2:1-e(t,s)(-2*n+2)/2}},bt["easeOutIn"+t]=function(t,s){return function(n){return n<.5?(1-e(t,s)(1-2*n))/2:(e(t,s)(2*n-1)+1)/2}}})),bt);function At(t,e){if(gt.fnc(t))return t;var s=t.split("(")[0],n=Et[s],i=vt(t);switch(s){case"spring":return yt(t,e);case"cubicBezier":return mt(Mt,i);case"steps":return mt(xt,i);default:return mt(n,i)}}function Tt(t){try{return document.querySelectorAll(t)}catch(t){return}}function Ft(t,e){for(var s=t.length,n=arguments.length>=2?arguments[1]:void 0,i=[],r=0;r<s;r++)if(r in t){var a=t[r];e.call(n,a,r,t)&&i.push(a)}return i}function _t(t){return t.reduce((function(t,e){return t.concat(gt.arr(e)?_t(e):e)}),[])}function St(t){return gt.arr(t)?t:(gt.str(t)&&(t=Tt(t)||t),t instanceof NodeList||t instanceof HTMLCollection?[].slice.call(t):[t])}function Rt(t,e){return t.some((function(t){return t===e}))}function Pt(t){var e={};for(var s in t)e[s]=t[s];return e}function Ot(t,e){var s=Pt(t);for(var n in t)s[n]=e.hasOwnProperty(n)?e[n]:t[n];return s}function Ct(t,e){var s=Pt(t);for(var n in e)s[n]=gt.und(t[n])?e[n]:t[n];return s}function Dt(t){var e=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(t);if(e)return e[1]}function It(t,e){return gt.fnc(t)?t(e.target,e.id,e.total):t}function Lt(t,e){return t.getAttribute(e)}function Nt(t,e,s){if(Rt([s,"deg","rad","turn"],Dt(e)))return e;var n=pt.CSS[e+s];if(!gt.und(n))return n;var i=document.createElement(t.tagName),r=t.parentNode&&t.parentNode!==document?t.parentNode:document.body;r.appendChild(i),i.style.position="absolute",i.style.width=100+s;var a=100/i.offsetWidth;r.removeChild(i);var o=a*parseFloat(e);return pt.CSS[e+s]=o,o}function Bt(t,e,s){if(e in t.style){var n=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),i=t.style[e]||getComputedStyle(t).getPropertyValue(n)||"0";return s?Nt(t,i,s):i}}function zt(t,e){return gt.dom(t)&&!gt.inp(t)&&(!gt.nil(Lt(t,e))||gt.svg(t)&&t[e])?"attribute":gt.dom(t)&&Rt(ct,e)?"transform":gt.dom(t)&&"transform"!==e&&Bt(t,e)?"css":null!=t[e]?"object":void 0}function Ut(t){if(gt.dom(t)){for(var e,s=t.style.transform||"",n=/(\w+)\(([^)]*)\)/g,i=new Map;e=n.exec(s);)i.set(e[1],e[2]);return i}}function Yt(t,e,s,n){switch(zt(t,e)){case"transform":return function(t,e,s,n){var i=ft(e,"scale")?1:0+function(t){return ft(t,"translate")||"perspective"===t?"px":ft(t,"rotate")||ft(t,"skew")?"deg":void 0}(e),r=Ut(t).get(e)||i;return s&&(s.transforms.list.set(e,r),s.transforms.last=e),n?Nt(t,r,n):r}(t,e,n,s);case"css":return Bt(t,e,s);case"attribute":return Lt(t,e);default:return t[e]||0}}function Xt(t,e){var s=/^(\*=|\+=|-=)/.exec(t);if(!s)return t;var n=Dt(t)||0,i=parseFloat(e),r=parseFloat(t.replace(s[0],""));switch(s[0][0]){case"+":return i+r+n;case"-":return i-r+n;case"*":return i*r+n}}function Vt(t,e){if(gt.col(t))return function(t){return gt.rgb(t)?(s=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(e=t))?"rgba("+s[1]+",1)":e:gt.hex(t)?function(t){var e=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(t,e,s,n){return e+e+s+s+n+n})),s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return"rgba("+parseInt(s[1],16)+","+parseInt(s[2],16)+","+parseInt(s[3],16)+",1)"}(t):gt.hsl(t)?function(t){var e,s,n,i=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(t)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(t),r=parseInt(i[1],10)/360,a=parseInt(i[2],10)/100,o=parseInt(i[3],10)/100,h=i[4]||1;function l(t,e,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+6*(e-t)*s:s<.5?e:s<2/3?t+(e-t)*(2/3-s)*6:t}if(0==a)e=s=n=o;else{var u=o<.5?o*(1+a):o+a-o*a,c=2*o-u;e=l(c,u,r+1/3),s=l(c,u,r),n=l(c,u,r-1/3)}return"rgba("+255*e+","+255*s+","+255*n+","+h+")"}(t):void 0;var e,s}(t);if(/\s/g.test(t))return t;var s=Dt(t),n=s?t.substr(0,t.length-s.length):t;return e?n+e:n}function qt(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Ht(t){for(var e,s=t.points,n=0,i=0;i<s.numberOfItems;i++){var r=s.getItem(i);i>0&&(n+=qt(e,r)),e=r}return n}function kt(t){if(t.getTotalLength)return t.getTotalLength();switch(t.tagName.toLowerCase()){case"circle":return function(t){return 2*Math.PI*Lt(t,"r")}(t);case"rect":return function(t){return 2*Lt(t,"width")+2*Lt(t,"height")}(t);case"line":return function(t){return qt({x:Lt(t,"x1"),y:Lt(t,"y1")},{x:Lt(t,"x2"),y:Lt(t,"y2")})}(t);case"polyline":return Ht(t);case"polygon":return function(t){var e=t.points;return Ht(t)+qt(e.getItem(e.numberOfItems-1),e.getItem(0))}(t)}}function Gt(t,e){var s=e||{},n=s.el||function(t){for(var e=t.parentNode;gt.svg(e)&&gt.svg(e.parentNode);)e=e.parentNode;return e}(t),i=n.getBoundingClientRect(),r=Lt(n,"viewBox"),a=i.width,o=i.height,h=s.viewBox||(r?r.split(" "):[0,0,a,o]);return{el:n,viewBox:h,x:h[0]/1,y:h[1]/1,w:a,h:o,vW:h[2],vH:h[3]}}function Wt(t,e,s){function n(s){void 0===s&&(s=0);var n=e+s>=1?e+s:0;return t.el.getPointAtLength(n)}var i=Gt(t.el,t.svg),r=n(),a=n(-1),o=n(1),h=s?1:i.w/i.vW,l=s?1:i.h/i.vH;switch(t.property){case"x":return(r.x-i.x)*h;case"y":return(r.y-i.y)*l;case"angle":return 180*Math.atan2(o.y-a.y,o.x-a.x)/Math.PI}}function jt(t,e){var s=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,n=Vt(gt.pth(t)?t.totalLength:t,e)+"";return{original:n,numbers:n.match(s)?n.match(s).map(Number):[0],strings:gt.str(t)||e?n.split(s):[]}}function Zt(t){return Ft(t?_t(gt.arr(t)?t.map(St):St(t)):[],(function(t,e,s){return s.indexOf(t)===e}))}function $t(t){var e=Zt(t);return e.map((function(t,s){return{target:t,id:s,total:e.length,transforms:{list:Ut(t)}}}))}function Qt(t,e){var s=Pt(e);if(/^spring/.test(s.easing)&&(s.duration=yt(s.easing)),gt.arr(t)){var n=t.length;2!==n||gt.obj(t[0])?gt.fnc(e.duration)||(s.duration=e.duration/n):t={value:t}}var i=gt.arr(t)?t:[t];return i.map((function(t,s){var n=gt.obj(t)&&!gt.pth(t)?t:{value:t};return gt.und(n.delay)&&(n.delay=s?0:e.delay),gt.und(n.endDelay)&&(n.endDelay=s===i.length-1?e.endDelay:0),n})).map((function(t){return Ct(t,s)}))}var Jt={css:function(t,e,s){return t.style[e]=s},attribute:function(t,e,s){return t.setAttribute(e,s)},object:function(t,e,s){return t[e]=s},transform:function(t,e,s,n,i){if(n.list.set(e,s),e===n.last||i){var r="";n.list.forEach((function(t,e){r+=e+"("+t+") "})),t.style.transform=r}}};function Kt(t,e){$t(t).forEach((function(t){for(var s in e){var n=It(e[s],t),i=t.target,r=Dt(n),a=Yt(i,s,r,t),o=Xt(Vt(n,r||Dt(a)),a),h=zt(i,s);Jt[h](i,s,o,t.transforms,!0)}}))}function te(t,e){return Ft(_t(t.map((function(t){return e.map((function(e){return function(t,e){var s=zt(t.target,e.name);if(s){var n=function(t,e){var s;return t.tweens.map((function(n){var i=function(t,e){var s={};for(var n in t){var i=It(t[n],e);gt.arr(i)&&1===(i=i.map((function(t){return It(t,e)}))).length&&(i=i[0]),s[n]=i}return s.duration=parseFloat(s.duration),s.delay=parseFloat(s.delay),s}(n,e),r=i.value,a=gt.arr(r)?r[1]:r,o=Dt(a),h=Yt(e.target,t.name,o,e),l=s?s.to.original:h,u=gt.arr(r)?r[0]:l,c=Dt(u)||Dt(h),p=o||c;return gt.und(a)&&(a=l),i.from=jt(u,p),i.to=jt(Xt(a,u),p),i.start=s?s.end:0,i.end=i.start+i.delay+i.duration+i.endDelay,i.easing=At(i.easing,i.duration),i.isPath=gt.pth(r),i.isPathTargetInsideSVG=i.isPath&&gt.svg(e.target),i.isColor=gt.col(i.from.original),i.isColor&&(i.round=1),s=i,i}))}(e,t),i=n[n.length-1];return{type:s,property:e.name,animatable:t,tweens:n,duration:i.end,delay:n[0].delay,endDelay:i.endDelay}}}(t,e)}))}))),(function(t){return!gt.und(t)}))}function ee(t,e){var s=t.length,n=function(t){return t.timelineOffset?t.timelineOffset:0},i={};return i.duration=s?Math.max.apply(Math,t.map((function(t){return n(t)+t.duration}))):e.duration,i.delay=s?Math.min.apply(Math,t.map((function(t){return n(t)+t.delay}))):e.delay,i.endDelay=s?i.duration-Math.max.apply(Math,t.map((function(t){return n(t)+t.duration-t.endDelay}))):e.endDelay,i}var se=0,ne=[],ie=function(){var t;function e(s){for(var n=ne.length,i=0;i<n;){var r=ne[i];r.paused?(ne.splice(i,1),n--):(r.tick(s),i++)}t=i>0?requestAnimationFrame(e):void 0}return"undefined"!=typeof document&&document.addEventListener("visibilitychange",(function(){ae.suspendWhenDocumentHidden&&(re()?t=cancelAnimationFrame(t):(ne.forEach((function(t){return t._onDocumentVisibility()})),ie()))})),function(){t||re()&&ae.suspendWhenDocumentHidden||!(ne.length>0)||(t=requestAnimationFrame(e))}}();function re(){return!!document&&document.hidden}function ae(t){void 0===t&&(t={});var e,s=0,n=0,i=0,r=0,a=null;function o(t){var e=window.Promise&&new Promise((function(t){return a=t}));return t.finished=e,e}var h=function(t){var e=Ot(lt,t),s=Ot(ut,t),n=function(t,e){var s=[],n=e.keyframes;for(var i in n&&(e=Ct(function(t){for(var e=Ft(_t(t.map((function(t){return Object.keys(t)}))),(function(t){return gt.key(t)})).reduce((function(t,e){return t.indexOf(e)<0&&t.push(e),t}),[]),s={},n=function(n){var i=e[n];s[i]=t.map((function(t){var e={};for(var s in t)gt.key(s)?s==i&&(e.value=t[s]):e[s]=t[s];return e}))},i=0;i<e.length;i++)n(i);return s}(n),e)),e)gt.key(i)&&s.push({name:i,tweens:Qt(e[i],t)});return s}(s,t),i=$t(t.targets),r=te(i,n),a=ee(r,s),o=se;return se++,Ct(e,{id:o,children:[],animatables:i,animations:r,duration:a.duration,delay:a.delay,endDelay:a.endDelay})}(t);function l(){var t=h.direction;"alternate"!==t&&(h.direction="normal"!==t?"normal":"reverse"),h.reversed=!h.reversed,e.forEach((function(t){return t.reversed=h.reversed}))}function u(t){return h.reversed?h.duration-t:t}function c(){s=0,n=u(h.currentTime)*(1/ae.speed)}function p(t,e){e&&e.seek(t-e.timelineOffset)}function d(t){for(var e=0,s=h.animations,n=s.length;e<n;){var i=s[e],r=i.animatable,a=i.tweens,o=a.length-1,l=a[o];o&&(l=Ft(a,(function(e){return t<e.end}))[0]||l);for(var u=dt(t-l.start-l.delay,0,l.duration)/l.duration,c=isNaN(u)?1:l.easing(u),p=l.to.strings,d=l.round,f=[],m=l.to.numbers.length,g=void 0,v=0;v<m;v++){var y=void 0,x=l.to.numbers[v],b=l.from.numbers[v]||0;y=l.isPath?Wt(l.value,c*x,l.isPathTargetInsideSVG):b+c*(x-b),d&&(l.isColor&&v>2||(y=Math.round(y*d)/d)),f.push(y)}var w=p.length;if(w){g=p[0];for(var M=0;M<w;M++){p[M];var E=p[M+1],A=f[M];isNaN(A)||(g+=E?A+E:A+" ")}}else g=f[0];Jt[i.type](r.target,i.property,g,r.transforms),i.currentValue=g,e++}}function f(t){h[t]&&!h.passThrough&&h[t](h)}function m(t){var c=h.duration,m=h.delay,g=c-h.endDelay,v=u(t);h.progress=dt(v/c*100,0,100),h.reversePlayback=v<h.currentTime,e&&function(t){if(h.reversePlayback)for(var s=r;s--;)p(t,e[s]);else for(var n=0;n<r;n++)p(t,e[n])}(v),!h.began&&h.currentTime>0&&(h.began=!0,f("begin")),!h.loopBegan&&h.currentTime>0&&(h.loopBegan=!0,f("loopBegin")),v<=m&&0!==h.currentTime&&d(0),(v>=g&&h.currentTime!==c||!c)&&d(c),v>m&&v<g?(h.changeBegan||(h.changeBegan=!0,h.changeCompleted=!1,f("changeBegin")),f("change"),d(v)):h.changeBegan&&(h.changeCompleted=!0,h.changeBegan=!1,f("changeComplete")),h.currentTime=dt(v,0,c),h.began&&f("update"),t>=c&&(n=0,h.remaining&&!0!==h.remaining&&h.remaining--,h.remaining?(s=i,f("loopComplete"),h.loopBegan=!1,"alternate"===h.direction&&l()):(h.paused=!0,h.completed||(h.completed=!0,f("loopComplete"),f("complete"),!h.passThrough&&"Promise"in window&&(a(),o(h)))))}return o(h),h.reset=function(){var t=h.direction;h.passThrough=!1,h.currentTime=0,h.progress=0,h.paused=!0,h.began=!1,h.loopBegan=!1,h.changeBegan=!1,h.completed=!1,h.changeCompleted=!1,h.reversePlayback=!1,h.reversed="reverse"===t,h.remaining=h.loop,e=h.children;for(var s=r=e.length;s--;)h.children[s].reset();(h.reversed&&!0!==h.loop||"alternate"===t&&1===h.loop)&&h.remaining++,d(h.reversed?h.duration:0)},h._onDocumentVisibility=c,h.set=function(t,e){return Kt(t,e),h},h.tick=function(t){i=t,s||(s=i),m((i+(n-s))*ae.speed)},h.seek=function(t){m(u(t))},h.pause=function(){h.paused=!0,c()},h.play=function(){h.paused&&(h.completed&&h.reset(),h.paused=!1,ne.push(h),c(),ie())},h.reverse=function(){l(),h.completed=!h.reversed,c()},h.restart=function(){h.reset(),h.play()},h.remove=function(t){he(Zt(t),h)},h.reset(),h.autoplay&&h.play(),h}function oe(t,e){for(var s=e.length;s--;)Rt(t,e[s].animatable.target)&&e.splice(s,1)}function he(t,e){var s=e.animations,n=e.children;oe(t,s);for(var i=n.length;i--;){var r=n[i],a=r.animations;oe(t,a),a.length||r.children.length||n.splice(i,1)}s.length||n.length||e.pause()}ae.version="3.2.1",ae.speed=1,ae.suspendWhenDocumentHidden=!0,ae.running=ne,ae.remove=function(t){for(var e=Zt(t),s=ne.length;s--;)he(e,ne[s])},ae.get=Yt,ae.set=Kt,ae.convertPx=Nt,ae.path=function(t,e){var s=gt.str(t)?Tt(t)[0]:t,n=e||100;return function(t){return{property:t,el:s,svg:Gt(s),totalLength:kt(s)*(n/100)}}},ae.setDashoffset=function(t){var e=kt(t);return t.setAttribute("stroke-dasharray",e),e},ae.stagger=function(t,e){void 0===e&&(e={});var s=e.direction||"normal",n=e.easing?At(e.easing):null,i=e.grid,r=e.axis,a=e.from||0,o="first"===a,h="center"===a,l="last"===a,u=gt.arr(t),c=u?parseFloat(t[0]):parseFloat(t),p=u?parseFloat(t[1]):0,d=Dt(u?t[1]:t)||0,f=e.start||0+(u?c:0),m=[],g=0;return function(t,e,v){if(o&&(a=0),h&&(a=(v-1)/2),l&&(a=v-1),!m.length){for(var y=0;y<v;y++){if(i){var x=h?(i[0]-1)/2:a%i[0],b=h?(i[1]-1)/2:Math.floor(a/i[0]),w=x-y%i[0],M=b-Math.floor(y/i[0]),E=Math.sqrt(w*w+M*M);"x"===r&&(E=-w),"y"===r&&(E=-M),m.push(E)}else m.push(Math.abs(a-y));g=Math.max.apply(Math,m)}n&&(m=m.map((function(t){return n(t/g)*g}))),"reverse"===s&&(m=m.map((function(t){return r?t<0?-1*t:-t:Math.abs(g-t)})))}return f+(u?(p-c)/g:c)*(Math.round(100*m[e])/100)+d}},ae.timeline=function(t){void 0===t&&(t={});var e=ae(t);return e.duration=0,e.add=function(s,n){var i=ne.indexOf(e),r=e.children;function a(t){t.passThrough=!0}i>-1&&ne.splice(i,1);for(var o=0;o<r.length;o++)a(r[o]);var h=Ct(s,Ot(ut,t));h.targets=h.targets||t.targets;var l=e.duration;h.autoplay=!1,h.direction=e.direction,h.timelineOffset=gt.und(n)?l:Xt(n,l),a(e),e.seek(h.timelineOffset);var u=ae(h);a(u),r.push(u);var c=ee(r,t);return e.delay=c.delay,e.endDelay=c.endDelay,e.duration=c.duration,e.seek(0),e.reset(),e.autoplay&&e.play(),e},e},ae.easing=At,ae.penner=Et,ae.random=function(t,e){return Math.floor(Math.random()*(e-t+1))+t};const le=ae;function ue(t){t=t||{};for(var e=1;e<arguments.length;e++){var s=arguments[e];if(s)for(var n in s)s.hasOwnProperty(n)&&("object"==typeof s[n]&&null!==s[n]?s[n]instanceof Array?t[n]=s[n].slice(0):t[n]=ue(t[n],s[n]):t[n]=s[n])}return t}function ce(t,e,s){return t*(1-s)+e*s}class pe extends class{constructor(t,e,s){this.animatedIn=!1,this.options=s||{},this.passes=t.passes,this.program=t,this.texture=e,this.animationParams={offsetX:0,offsetY:0,scaleX:1,scaleY:1,strength:0,opacity:1},this.params={progress:0,velocity:0,translateX:0,translateY:0,translateZ:0}}play(){}render(){}mouseMove(){}onScroll(){}mouseOver(){}mouseOut(){}enable(){this.enabled=!0}disable(){this.enabled=!1}}{constructor(t,e,s){super(t,e,s),this.delay=this.options.delay||0}play(t){super.play(),t&&(this.options=ue({},this.options,t)),this.duration=this.options.in.duration,this.delay=this.options.in.delay,this.inAnimation&&this.inAnimation.remove(this.animationParams);const e=this;this.lastTime=0,this.animationParams.progress=0,this.animationParams.velocity=0,this.params.progress=0,this.inAnimation=le({targets:this.animationParams,offset:0,progress:1,duration:this.duration,easing:this.options.in.easing,delay:this.delay,change:function(){e.started=!0,e.params.progress=e.animationParams.progress},complete:function(){e.params.progress=1,e.params.velocity=0}})}render(){}}class de{constructor(t,e){return t.addPass({fragment:"\n\n// precision highp float;\nprecision mediump float;\n\nuniform sampler2D tMap;\nuniform sampler2D tAlphaMap;\nuniform sampler2D tTransition;\nuniform float strength;\nuniform float progress;\nuniform float speed;\nuniform float threshold;\nuniform float displacement;\nuniform float angle;\nuniform float tAspect;\nuniform vec2 uDirection;\nuniform float planeW;\nuniform float planeH;\nuniform float planeX;\nuniform float planeY;\nuniform float alphaMapAngle;\nuniform vec3 velocity;\n\n// uniform float scroll;\n\nvarying vec2 vUv;\n\n// distance from line (pt1, pt2 and point pt3)\nfloat dist(vec2 pt1, vec2 pt2, vec2 pt3){\n   vec2 v1 = pt2 - pt1; //line vector\n   vec2 v2 = pt1 - pt3;\n   vec2 v3 = vec2(v1.y,-v1.x);\n   return abs(dot(v2,normalize(v3)));\n}\n\nvec2 vectorFromAngle(float angleDeg) {\n    float angleRad = radians(angleDeg);\n    return vec2(cos(angleRad), sin(angleRad));\n}\n\nvoid main() {\n    vec2 uv = vUv;\n\t/*\n\tvec2 uvAlphaMap = uv;\n\tif( tAspect > 1. ){\n\t\tuvAlphaMap -= .5;\n\t\tuvAlphaMap.y /= tAspect;\n\t\tuvAlphaMap += .5;\n\t} \n\t\n    vec4 colorAlpha = texture2D(tAlphaMap, uvAlphaMap);\n\n    float spread = 0.01;\n    vec4 colorAlpha2 = texture2D(tAlphaMap, uvAlphaMap + vec2(spread, spread));\n    vec4 colorAlpha3 = texture2D(tAlphaMap, uvAlphaMap + vec2(-spread, spread));\n    vec4 colorAlpha4 = texture2D(tAlphaMap, uvAlphaMap + vec2(spread, -spread));\n    vec4 colorAlpha5 = texture2D(tAlphaMap, uvAlphaMap + vec2(-spread, -spread));\n\tcolorAlpha = (colorAlpha + colorAlpha2 + colorAlpha3 + colorAlpha4 + colorAlpha5) / 5.;\n\n    float d = 1. - (colorAlpha.r + colorAlpha.g + colorAlpha.b) / 3.; \n*/\n\tfloat d = 0.;\n\tif(alphaMapAngle == 0.){\n\t\td = uv.x;\n\t}else if(alphaMapAngle == 180.){\n\t\td = 1. - uv.x;\n\t}else if(alphaMapAngle == 90.){\n\t\td = uv.y;\n\t}else if(alphaMapAngle == 270.){\n\t\td = 1. - uv.y;\n\t}else if(alphaMapAngle == 45.){\n\t\td = (uv.y * uv.y + uv.x * uv.x) / 2.;\n\t}else if(alphaMapAngle == 135.){\n\t\td = (uv.y * uv.y + (1. - uv.x) * (1. - uv.x)) / 2.;\n\t}else if(alphaMapAngle == 225.){\n\t\td = ((1. - uv.y) * (1. - uv.y) + (1. - uv.x) * (1. - uv.x)) / 2.;\n\t}else if(alphaMapAngle == 315.){\n\t\td = (uv.x * uv.x + (1. - uv.y) * (1. - uv.y)) / 2.;\n\t}\n\n\n\t//test\n\t// float d = 1.;\n\n\n\t// d *= distance(uv, vec2(.0)) / ( sqrt(2.) / 1.); // distance from uv to point \n\t// d = pow(d, 3.);\n\t// d *= dist(vec2(0., 0.), vec2(0., 1.), uv); //distance form uv to line de,fined by two points\n\n\n\t// d *= uv.x;\n\t// d *= uv.y;\n\n    //displacement\n\tfloat dis = displacement;\n\t// dis = 1.; // test displacement\n    if(dis != 0.){\n        vec2 displacement_xy = vec2(dis * sin(angle), -dis * cos(angle));\n        uv -= .5;\n        uv -= d * strength * displacement_xy; \n        uv += .5;\n        if(uv.x < 0. || uv.x > 1. || uv.y < 0. || uv.y > 1.) discard;\n    }\n\n\t/** RGB split */\n\t// vec2 direction = vectorFromAngle(alphaMapAngle);\n    // vec4 colorR = texture2D(tMap, uv + velocity.xy);\n    // vec4 colorGBA = texture2D(tMap, uv);\n    // vec4 colorBA = texture2D(tMap, uv - velocity.xy );\n\t// vec4 color = vec4(colorR.r, colorGBA.gba);\n\n\tvec4 color = texture2D(tMap, uv);\n\n\n\n\t// d *= color.r / progress;\n\n    // vec2 distanceVector = uv - uDirection;\n    // float dist;\n  \n    float distMax = 1.;\n    // dist = sqrt(dot(distanceVector, distanceVector));\n\n    /*\n    if(uDirection.y == .5 )\n        dist = uv.x;\n    else if(uDirection.x == .5 )\n        dist = uv.y;\n    else if(uDirection.x == -.5 )\n        dist = 1. - uv.y;\n    else if(uDirection.y == -.5 )\n        dist = 1. - uv.x;\n    // bottom right\n    else if(uDirection.x == 1. && uDirection.y == 0.){\n        dist = abs(-uv.x + uv.y + 1.) / sqrt(2.);\n        distMax = sqrt(2.);\n    }\n    // top right\n    else if(uDirection.x == 1. && uDirection.y == 1.){\n        dist = abs(uv.x + uv.y - 2.) / sqrt(2.);\n        distMax = sqrt(2.);\n    }\n    // top left\n    else if(uDirection.x == 0. && uDirection.y == 1.){\n        dist = abs(-uv.x + uv.y - 1.) / sqrt(2.);\n        distMax = sqrt(2.);\n    }\n    // bottom left\n    else if(uDirection.x == 0. && uDirection.y == 0.){\n        dist = abs(uv.x + uv.y) / sqrt(2.);\n        distMax = sqrt(2.);\n    }\n\n    */\n\n    // d = dist;\n\n\t/* strips \n\tfloat stripes = 1.;\n\tfloat stripesDelay = .0;\n\tfloat duration = 1. - stripesDelay * (stripes - 1.);\n\tfloat progressStripes = (progress - floor((1. - uv.y) * stripes) * stripesDelay) / duration;  \n\t*/\n\n\tfloat progressStripes = progress;\n\n    if(progressStripes != 1.){\n\n\t\tif(threshold == 0.){\n\n\t\t\tcolor.a *= step(d, smoothstep(0., 1. ,progressStripes));\n\n\t\t}else if(threshold >= 3.){\n\n            color.a *= progressStripes;\n\n        }else{\n\n\t\t\td += color.r / 3.;\n\n            // color.rgb /= .2 + .8 * smoothstep(dist, dist + s, progress * distMax * (1. + s));\n            color.a *= smoothstep(d, d + threshold, progressStripes * distMax * (1. + threshold));        \n\t\t}\n\n\t\t// color.a = pow(color.a, 2.);\n    }\n\n\t\n\n    gl_FragColor = color;\n\n\t// gl_FragColor = vec4(vec3(d), 1.);\n    \n}\n\n",uniforms:{strength:{value:1},progress:{value:0},speed:{value:0},velocity:{value:new v(0)},tAlphaMap:{value:null},threshold:{value:e.fade.threshold},displacement:{value:0},angle:{value:0},planeW:{value:0},planeH:{value:0},planeX:{value:0},planeY:{value:0},tAspect:{value:1},alphaMapAngle:{value:0}},transparent:!0})}}class fe{constructor(t,{domElement:e,index:s,options:n}={}){this.gl=t,this.animations={},this.index=s,this.mouse=new a(-1),this.originalOptions=JSON.parse(JSON.stringify(n)),this.useOffscreenCanvas=!0,this.dataURL=!1,this.initDomElement(e),this.initOptions(),this.init3d(),this.initAnimationParams(),this.initAnimations(),this.addListeners(),this.enabled=!0}initDomElement(t){if(this.originalDomElement=t,new ResizeObserver((e=>{const s=e.find((e=>e.target===t)),n=s.devicePixelContentBoxSize[0].inlineSize,i=s.devicePixelContentBoxSize[0].blockSize;console.log("ResizeObserver: ",n,i)})),this.cssClasses=Array.from(t.classList),this.textureImg=new Image,this.textureImg.crossOrigin="anonymous",this.alphaMapImg=new Image,this.alphaMapImg.crossOrigin="anonymous","FIGURE"==t.nodeName&&(t=t.children[0]),"IMG"!=t.nodeName&&t.classList.contains("agl-img")){const e=t.querySelectorAll("img");e.length>0&&(t.style.visibility="visible",(t=e[0]).style.visibility="hidden")}if("IMG"==t.nodeName)this.textureImg.src=t.src,this.isImage=!0;else{let t="none";const e=this;"none"!==t?(this.textureImg.onload=function(){e.imageAspect=this.width/this.height,e.program.uniforms.tScale.value=e.imageAspect/e.aspect,e.texture.image=e.textureImg,e.animeIn(e.options)},this.textureImg.src=t):this.htmlToCanvas=!0}this.domElement=t}initAnimationParams(){this.animationParams={translateX:0,translateY:0,translateZ:0}}init3d(){const t=this.gl;this.texture=new j(t,{premultiplyAlpha:!0});const e=new ht(t,{widthSegments:100,heightSegments:100});this.program=this.program=new N(t,{vertex:"\n\nprecision mediump float;\n\nattribute vec3 position;\nattribute vec2 uv;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nvarying vec2 vUv;\nuniform vec2 scale;\nuniform float radius;\nuniform float strength; // reversed progress \nuniform float bend;\nuniform float scrollBend;\nuniform float stretch;\nuniform float curl;\nuniform float progress;\n// uniform float offset;\n// uniform float angle;\nuniform float scrollAngle;\nuniform float origin;\nuniform float fisheye;\nuniform float scrollFisheye;\nuniform sampler2D tAlphaMap;\nuniform float displacement;\nuniform float scrollDisplacement;\nuniform float planeW;\nuniform float planeH;\nuniform float planeX;\nuniform float planeY;\nuniform float tAspect;\nuniform vec3 translate;\nuniform vec3 rotate;\nuniform vec2 p1;\nuniform vec2 p2;\nuniform vec2 p3;\nuniform vec2 p4;\nuniform float easeX;\nuniform float easeY;\n\n#define PI 3.1415926535897932384626433832795\n\nvec3 deformationCurve(vec3 position, vec2 uv, float bend) {\n\tfloat d = 1.;\n\t// if(bend < 0.) d = 0.;\n    position.y = position.y + (( cos((position.x + .0) * PI * 1.) - d) * bend);\n    return position;\n}\n\nfloat ease(float type, float value){\n\tif(type == 1.){\n\t\treturn 1. - sin(value * PI / 2. + PI / 2.);\n\t}else if(type == 2.){\n\t\treturn sin(value * PI / 2.);\n\t}else if(type == 3.){\n\t\treturn 1. - sin(value * PI);\n\t}else{\n\t\treturn value;\n\t}\n}\n\nvoid main() {\n    vUv = uv;\n\tvec3 pos = position;\n\n\tvec4 colorAlpha = texture2D(tAlphaMap, uv);\n\n\t\n\n\t\n\t// pos.z += colorAlpha.r * displacement * .1;\n\n\t// pos.x *= scale.x;\n\t// pos.y *= scale.y;\n\n\t//bend\n\n\t// if(stretch > 0.){\n\t// \tpos.xy += vec2(.5);\n\t// \tpos.y += pow( pos.y, 3.) * stretch;\n\t// \tpos.xy -= vec2(.5);\n\t// }else if (stretch < 0.){\n\t// \tpos.xy += vec2(.5);\n\t// \tpos.y += pow(1. - pos.y, 3.) * stretch;\n\t// \tpos.xy -= vec2(.5);\n\t// }\n\n\tif(curl != 0.){\n\t\t// constraint LEFT\n\n\t\tfloat bendOrigin = 1. - curl; // 0 - from left\n\n\t\t// if(pos.x > bendOrigin){\n\n\t\t\t// pos.x -= bendOrigin;\n\n\t\t\t//rotate before bend\n\n\t\t\t// float rot = angle - PI / 2.;\n\t\t\tfloat rot = - PI / 2.;\n\t\t\tmat2 m = mat2(cos(rot), -sin(rot), sin(rot), cos(rot));\n\t\t\tpos.xy *= m;\n\n\t\t\tif(pos.x > bendOrigin){\n\t\t\t\tpos.x -= bendOrigin;\n\n\t\t\t\t// float r = radius / strength;\n\t\t\t\tfloat r = radius * pow(curl, .5) / curl;\n\t\t\t\tfloat x = pos.x ;\n\t\t\t\tfloat a = x / r ;\n\t\t\t\tpos.z = (1. - cos(a)) * r;\n\t\t\t\tpos.x = sin(a) * r;\n\t\t\t\tpos.x += bendOrigin;\n\t\t\t}\n\n\t\t\t//rotate back after bend\n\t\t\tm = mat2(cos(-rot), -sin(-rot), sin(-rot), cos(-rot));\n\t\t\tpos.xy *= m;\n\n\t\t\t// pos.x += bendOrigin;\n\n\t\t// }\n\n\t\t//constraint RIGHT\n\n\t\t// pos.x += .5;\n\n\t\t// float r = radius / strength;\n\t\t// float x = 1. - pos.x;\n\t\t// float a = x / r ;\n\t\t// pos.z = (1. - cos(a)) * r;\n\t\t// pos.x = 1. - sin(a) * r;\n\n\t\t// pos.x -= .5;\n\n\t\t//bend end\n\n\t\t// pos.z += pow(1. - (pos.x - (1. - strength)), 2.);\n\n\t}\n\n\n\n\n\t// pos.x += pow(pos.x, 2.) * (scale.x - 1.);\n\t// pos.y += pow(1. + pos.y, 1.5) ;\n\t// pos.y += pow(1. + pos.y, 2.) * ( scale.y - 1.);\n\n\t// vec2 offsetxy = vec2(offset * sin(angle), offset  * cos(angle));\n\n\t// pos += vec3(offsetxy, 0.);\n\n\n\t//   pos += vec3(.5 + offset.x, -.5 + offset.y, 0.);\n\n\n\t// BEND 2D\n\t// if(bend != 0.){\n\t// \tfloat a = angle + PI / 2.;\n\t// \tpos.xy *= mat2(cos(angle), -sin(angle), sin(angle), cos(angle));\n\t// \tpos = deformationCurve(pos, uv, bend);\n\t// \tpos.xy *= mat2(cos(-angle), -sin(-angle), sin(-angle), cos(-angle));\n\t// }\n\n\tif(scrollBend != 0.){\n\t\tif(scrollAngle != 0.) pos.xy *= mat2(cos(scrollAngle), -sin(scrollAngle), sin(scrollAngle), cos(scrollAngle));\n\t\tpos = deformationCurve(pos, uv, scrollBend);\n\t\tif(scrollAngle != 0.) pos.xy *= mat2(cos(-scrollAngle), -sin(-scrollAngle), sin(-scrollAngle), cos(-scrollAngle));\n\t}\n\n\t// mat2 m = mat2(cos(angle), -sin(angle), sin(angle), cos(angle));\n\t// pos -= vec3(.5, -.5, 0.);\n\t// pos.xy *= m;\n\t// pos += vec3(.5, -.5, 0.);\n\n\n\t//test scale\n\t//   pos.x += pow(pos.x, 3.) * (scale.x - 1.);\n\n\n\t// test\n\tfloat screenY;\n\tif(fisheye != 0.){\n\t\tscreenY = (pos.y) * planeH + planeY - .5; \n\t\tpos.z += sin((screenY) * PI) * fisheye;\n\t}\n\n\tif(scrollFisheye != 0.){\n\t\tscreenY = (pos.y) * planeH + planeY - .5; \n\t\tpos.z += sin((screenY) * PI) * scrollFisheye;\n\t}\n\n\n\n\t//center 3D bend in / out based on scroll\n\n\t/*\n\tif(fisheye > 0.){\n\t\tpos.z = sin((screenY) * M_PI) * fisheye;\n\t}else if(fisheye < 0.){\n\n\t\t// if(scroll < 0.)\n\t\t// \tpos.z = pow(- screenY - 1., 31.) * scroll * fisheye * -10.;\n\t\t// else\n\t\t// \tpos.z = - pow(screenY, 31.) * scroll * fisheye * -10.;\n\n\t\tif(scrollAngle > 0.) \n\t\t\tpos.z = - pow(screenY, 31.) * fisheye * -10.;\n\t\telse\n\t\t\tpos.z = + pow(screenY, 31.) * fisheye * -10.;\n\n\t}\n\t*/\n\n\t// pos.z += strength * 3. * smoothstep(-.5, .5, pos.x) * smoothstep(-.5, .5, pos.y);\n\t// pos.x += strength * 3. * smoothstep(-.5, .5, pos.x);\n\t// pos.z += 5. * strength * cos(pos.x * M_PI / 2.) * cos(pos.y * M_PI / 2.);\n\n\t// pos.z -= 1. * strength + 3. * (sin((pos.x - .5)* M_PI * .5)) * (sin((pos.y - .5)* M_PI * .5)) * strength;\n\t// pos.z = -2. * strength + (.5 * (sin((pos.x - .5)* M_PI * 1.)) * (sin((pos.y - .5)* M_PI * 1.)))* sin(strength * M_PI);\n\t\t\n\t// pos.z += - 3. * ( sin(((uv.x) * M_PI / 2.)) + sin(((uv.y) * M_PI / 2.))) * sin(strength * M_PI);\n\t// if(strength > .3)\n\t// \tpos.z -= pow(strength - .3, 2.) * 10.;\n\n\t// if(p1.x > 0. || p2.x > 0. || p3.x > 0. || p4.x > 0. || p1.y < 1. || p2.y < 1. || p3.y < 1. || p4.y < 1.){\n\n\t\tvec3 start = pos;\n\t\tfloat asp = 64./40.;\n\t\tstart.x *= asp;\n\t\tif(rotate.x != 0.){\n\t\t\tmat2 m1 = mat2(cos(rotate.x), -sin(rotate.x), sin(rotate.x), cos(rotate.x));\n\t\t\tstart.yz *= m1;\n\t\t}\n\t\tif(rotate.y != 0.){\n\t\t\tmat2 m2 = mat2(cos(rotate.y), -sin(rotate.y), sin(rotate.y), cos(rotate.y));\n\t\t\tstart.xz *= m2;\n\t\t}\n\t\tif(rotate.z != 0.){\n\t\t\tmat2 m3 = mat2(cos(rotate.z), -sin(rotate.z), sin(rotate.z), cos(rotate.z));\n\t\t\tstart.xy *= m3;\n\t\t}\n\t\tstart.x /= asp;\n\t\tstart += translate;\n\n\t\tfloat p11 = smoothstep(p1.x, p1.y, progress);\n\t\tfloat p22 = smoothstep(p2.x, p2.y, progress);\n\t\tfloat p33 = smoothstep(p3.x, p3.y, progress);\n\t\tfloat p44 = smoothstep(p4.x, p4.y, progress);\n\n\t\tfloat xEase = ease(easeX, uv.x);\n\t\tfloat yEase = ease(easeY, uv.y);\n\n\t\tfloat currentPos = mix(\n\t\t\tmix(p11, p22, xEase),\n\t\t\tmix(p33, p44, xEase),\n\t\t\tyEase\n\t\t);\n\n\t\tpos = mix(start, pos, currentPos);\n\t// }\n\n\n\t// if(displacement != 0.){\n\n\t\t// vec2 displacement_xy = vec2(displacement * sin(angle), displacement * cos(angle));\n\t\t// pos.xy += (1. - colorAlpha.r) * displacement_xy;\n\n\t// }\n\n\tif(scrollDisplacement != 0.){\n\n\t\tvec2 displacement_xy_scroll = vec2(scrollDisplacement * sin(scrollAngle), scrollDisplacement * cos(scrollAngle));\n\t\tpos.xy += (1. - colorAlpha.r) * displacement_xy_scroll;\n\n\t}\n  \n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);\n}\n\n",fragment:"\n    precision highp float;\n    uniform sampler2D tMap;\n    uniform float tScale;\n    varying vec2 vUv;\n    void main() {\n        vec2 uv = vUv;\n        uv -= .5;\n        if(tScale < 1.)\n            uv.y *= tScale;\n        else if (tScale > 1.)\n            uv.x /= tScale;\n        uv += .5;\n        vec4 color = texture2D(tMap, uv);\n        gl_FragColor = vec4(color.rgb * color.a, color.a);\n    }\n",uniforms:{tMap:{value:this.texture},tAspect:{value:2},tScale:{value:1},translate:{value:new v(0,0,0)},rotate:{value:new v(0,0,0)},displacement:{value:0},scrollDisplacement:{value:0},scale:{value:new a(1,1)},resolution:{value:new a(300,300)},uMouse:{value:new a(10,10)},radius:{value:.5},strength:{value:.5},progress:{value:.5},center:{value:new a(.7,.7)},direction:{value:new a(-.001,-.001)},time:{value:0},angle:{value:0},scrollAngle:{value:0},bend:{value:0},scrollBend:{value:0},fisheye:{value:0},scrollFisheye:{value:0},stretch:{value:0},curl:{value:0},tAlphaMap:{value:this.texture},planeW:{value:0},planeH:{value:0},planeX:{value:0},planeY:{value:0},p1:{value:new a(0,1)},p2:{value:new a(0,1)},p3:{value:new a(0,1)},p4:{value:new a(0,1)},easeX:{value:1},easeY:{value:1}},depthTest:!0,transparent:!0,depthFunc:t.ALWAYS,cullFace:null}),this.post=new st(t,{dpr:window.devicePixelRatio,targetOnly:!0,alpha:!1}),this.post.addPass({transparent:!0}),this.alphaMap=new j(t,{}),this.passes={},this.passes.fade=new de(this.post,this.options.in),this.passes.fade.uniforms.tAlphaMap.value=this.alphaMap,this.mesh=new H(t,{geometry:e,program:this.program}),this.mesh.visible=!1,this.zPosition=0}initOptions(){const t=this;this.options=JSON.parse(JSON.stringify(this.originalOptions));const e=this.originalDomElement.className,s=agl.defaults.in.presets;(e.includes("agl-in-fade")||e.includes("agl-in-translate")||e.includes("agl-in-rotate"))&&(this.options.in.translate={x:0,y:0,z:0},this.options.in.rotate={x:0,y:0,z:0},this.options.in.fade.type="right");for(const t in s)e.includes(`agl-${t}`)&&(this.options.in=JSON.parse(JSON.stringify(agl.defaults.in)),this.options.in=ue({},this.options.in,s[t]),this.options.in.name=t,this.options.in.nameFromCSSClass=t);this.options.in.name&&(this.options.in=ue({},this.options.in,s[this.options.in.name])),this.originalDomElement.classList.forEach((function(e){t.getOptionsFromClassName(e,t.options.in)}))}cssClassUpdated(){const t=Array.from(this.originalDomElement.classList),e=this.cssClasses,s=t.filter((t=>-1===e.indexOf(t))).join("");this.cssClasses=t,s.indexOf("agl")>=0&&(this.enable(),this.initOptions(),this.animatedIn=!1,this.animeIn(this.options))}initAnimations(){this.animations.in=new pe(this.program,this.texture,this.options),this.timeOld=performance.now(),this.meshVelocityLerp={x:0,y:0,z:0},this.meshPositionOld=this.mesh.position}addListeners(){const t=this.originalDomElement,e=this;window.addEventListener("agl-animate",(function(){e.options.in.live=!1,e.animatedIn=!1,e.enable(),e.animeIn()})),t.addEventListener("agl-disable",(function(t){e.disable()})),t.addEventListener("agl-enable",(function(t){e.enable()})),t.addEventListener("agl-remove",(function(t){})),t.addEventListener("agl-animate",(function(t){e.onAnimate(t)})),t.addEventListener("agl-update-setting",(function(t){})),window.addEventListener("agl-option-change",(function(t){const s=JSON.parse(JSON.stringify(t.detail));if(s.in.name){const t=agl.defaults.in.presets;e.options.in.nameFromCSSClass||(e.options.in=ue({},agl.defaults.in,t[s.in.name]))}else e.options.in.nameFromCSSClass||(e.options=s);e.options.in.live=s.in.live,e.options.in.live&&(e.options.in.progress=s.in.progress);const n=e.originalDomElement.className;(n.includes("agl-in-fade")||n.includes("agl-in-translate")||n.includes("agl-in-rotate"))&&(e.options.in.translate={x:0,y:0,z:0},e.options.in.rotate={x:0,y:0,z:0},e.options.in.fade.type="right"),e.originalDomElement.classList.forEach((function(t){e.getOptionsFromClassName(t,e.options.in)})),e.enable(),e.updateVisibility(),e.animatedIn=!1,e.animeIn(e.options)}));const s=this.domElement;new MutationObserver((t=>{t.forEach((t=>{if(t.attributeName.includes("src")){const t=new Image;t.crossOrigin="anonymous",t.src=s.src,t.onload=function(){e.texture.image=t}}}))})).observe(s,{attributes:!0}),t.addEventListener("click",(function(t){})),t.addEventListener("mouseover",this.mouseOver.bind(this)),t.addEventListener("mousemove",(function(t){e.mouseX=(t.pageX-e.rect.x)/e.rect.width,e.mouseY=(t.pageY-e.rect.y)/e.rect.height})),t.addEventListener("mouseout",this.mouseOut.bind(this))}onAnimate(t){this.animatedIn=!1;const e=JSON.parse(JSON.stringify(agl.options));let s=e.in;s.scroll=e.scroll,s.mouse=e.mouse,this.getOptionsFromClassName(t.options.entranceName),s=ue({},s,t.options);const n=this;if(s.transitionImageSrc){const t=new Image;t.src=s.transitionImageSrc,t.crossOrigin="anonymous",t.onload=function(){n.alphaMapImg=t,n.animeIn(s)}}else this.animeIn(s)}onMouseMove(t){this.mouseMove(t)}getOptionsFromClassName(t){const e=this.options,s={right:0,left:180,up:90,down:270,topRight:45,topLeft:135,bottomLeft:225,bottomRight:315};if(t.includes("in-fade")&&t.includes("fade-")&&(e.in.fade.type=t.split("fade-")[1]),"none"==e.in.fade.type?e.in.fade.enabled=!1:e.in.fade.enabled=!0,"basic"==e.in.fade.type&&(e.in.fade.threshold=3),e.in.fade.alphaMapAngle=s[e.in.fade.type]||s.right,t.includes("in-translate")&&(e.in.translate.enabled=!0,this.getOptionFromClassName(t,e.in.translate,"x"),this.getOptionFromClassName(t,e.in.translate,"y"),this.getOptionFromClassName(t,e.in.translate,"z")),t.includes("in-rotate")&&(e.in.rotate.enabled=!0,this.getOptionFromClassName(t,e.in.rotate,"x"),this.getOptionFromClassName(t,e.in.rotate,"y"),this.getOptionFromClassName(t,e.in.rotate,"z")),t.includes("in-corners-start")){e.in.corners.enabled=!0;const s=t.split("in-corners-start-")[1].split("-");e.in.corners.start1=Number(s[0]),e.in.corners.start2=Number(s[1]),e.in.corners.start3=Number(s[2]),e.in.corners.start4=Number(s[3])}if(t.includes("in-corners-end")){e.in.corners.enabled=!0;const s=t.split("in-corners-end-")[1].split("-");e.in.corners.end1=Number(s[0]),e.in.corners.end2=Number(s[1]),e.in.corners.end3=Number(s[2]),e.in.corners.end4=Number(s[3])}this.getOptionFromClassName(t,e.in,"delay"),this.getOptionFromClassName(t,e.in,"duration"),this.getOptionFromClassName(t,e.in.fade,"threshold"),this.getOptionFromClassName(t,e.in,"easing"),t.includes("agl-scroll-bend-")&&(e.scroll.bend.strength=t.split("agl-scroll-bend-")[1]),t.includes("agl-scroll-fisheye-")&&(e.scroll.fisheye.strength=t.split("agl-scroll-fisheye-")[1]),t.includes("agl-scroll-fisheye-type")&&(e.scroll.fisheye.type=t.split("agl-scroll-fisheye-type")[1]),t.includes("agl-scroll-stretch-")&&(e.scroll.stretch.strength=t.split("agl-scroll-stretch-")[1]),t.includes("agl-scroll-displacement-")&&(e.scroll.fade.displacement=t.split("agl-scroll-displacement-")[1]),t.includes("agl-scroll-translateX-")&&(e.scroll.translateX=t.split("agl-scroll-translateX-")[1]),t.includes("agl-scroll-translateY-")&&(e.scroll.translateY=t.split("agl-scroll-translateY-")[1]),t.includes("agl-scroll-translateY-")&&(e.scroll.translateZ=t.split("agl-scroll-translateZ-")[1])}getOptionFromClassName(t,e,s){t.includes(`-${s}-`)&&(e[s]=t.split(`-${s}-`)[1],isNaN(Number(e[s]))||(e[s]=Number(e[s])))}mouseMove(t){this.mouse.x=(t.pageX-this.rect.x)/this.rect.width,this.mouse.y=1-(t.pageY-this.rect.y)/this.rect.height,this.animations.hover&&this.animations.hover.mouseMove(this.mouse)}mouseOver(t){this.animations.hover&&this.animations.hover.mouseOver(),this.hover=!0,this.mouseX=(t.pageX-this.rect.x)/this.rect.width,this.mouseY=(t.pageY-this.rect.y)/this.rect.height}mouseOut(t){this.oldMouse=null,this.animations.hover&&this.animations.hover.mouseOut(),this.hover=!1}async animeIn(t){if(this.visible&&!this.animatedIn){if(this.animatedIn=!0,this.options.in.fade.alphaMapSrc&&(this.alphaMapImg.src=this.options.in.fade.alphaMapSrc),this.htmlToCanvas&&await this.renderHTMLToCanvas(),await this.loadTextures(),this.post&&this.post.passes&&this.post.passes.length){const t=this.textureImg;this.post.passes.forEach((function(e){e.uniforms.tAspect&&(e.uniforms.tAspect.value=t.naturalWidth/t.naturalHeight)}))}this.texture.image=this.textureImg,this.alphaMap.image=this.alphaMapImg,this.animations.in&&(this.updatePositions(),this.animations.in.play(t),this.mesh.visible=!0)}}loadTextures(){const t=[this.loadImage(this.textureImg)];return Promise.all(t)}getCanvas(t,e){return this.canvasForRenderingHTML||(this.useOffscreenCanvas&&"undefined"!=typeof OffscreenCanvas?this.canvasForRenderingHTML=new OffscreenCanvas(t,e):this.canvasForRenderingHTML=document.createElement("canvas")),this.canvasForRenderingHTML.width=t,this.canvasForRenderingHTML.height=e,this.canvasForRenderingHTML}renderHTMLToCanvas(){const t=this.domElement,e=this;return new Promise((function(s,n){if(e.textureImg.src)s();else if("undefined"!=typeof html2canvas){t.style.visibility="visible",performance.now();const n=window.devicePixelRatio,i=t.offsetWidth*n,r=t.offsetHeight*n,a=e.getCanvas(i,r);e.renderingHTML=!0;const o=a.getContext("2d");o.imageSmoothingEnabled=!1,o.textRendering="geometricPrecision",html2canvas(t,{backgroundColor:null,logging:!1,scale:n,ignoreElements:function(e){return!e.contains(t)&&!t.contains(e)&&t!==e&&"HEAD"!=e.nodeName&&"STYLE"!=e.nodeName&&"META"!=e.nodeName&&"LINK"!=e.nodeName},onclone:function(t,e){e.querySelectorAll("span").forEach((function(t){"flex"==window.getComputedStyle(t).display&&e.querySelectorAll("span").forEach((function(t){"static"==window.getComputedStyle(t).position&&(t.style.position="relative")}))}))},canvas:a}).then((function(t){e.renderingHTML=!1,e.dataURL?(e.textureImg.src=t.toDataURL(),s()):e.useOffscreenCanvas&&"undefined"!=typeof OffscreenCanvas?t.convertToBlob({type:"image/webp"}).then((t=>{const n=URL.createObjectURL(t);e.textureImg.src=n,e.textureImg.addEventListener("load",(function(){URL.revokeObjectURL(n),s()}))})):t.toBlob((t=>{const n=URL.createObjectURL(t);e.textureImg.src=n,e.textureImg.addEventListener("load",(function(){URL.revokeObjectURL(n),s()}))}),"image/webp")})).catch((t=>{console.log("html2canavs error: ",t),s()})),t.style.visibility="hidden"}}))}loadImage(t){return new Promise((function(e,s){t.complete&&0!==t.naturalHeight?e(t):(t.addEventListener("load",(function(){e(this)})),t.addEventListener("error",(function(){s(new Error("Image not found"))})))}))}update(){this.updatePositions()}updatePositions(){const t=this.domElement.getBoundingClientRect(),e=window.devicePixelRatio;if(this.rect={x:t.x,y:t.y+scrollY,width:t.width,height:t.height},this.aspect=t.width/t.height,this.program.uniforms.tScale.value=this.imageAspect/this.aspect,(this.postWidth!=t.width||this.postHeight!=t.height)&&(this.post.resize({width:t.width,height:t.height,dpr:e}),this.postWidth&&this.postHeight&&this.htmlToCanvas)){const t=this;this.textureImg=new Image,this.enabled&&this.renderHTMLToCanvas().then((function(){t.texture.image=t.textureImg}))}this.postWidth=t.width,this.postHeight=t.height,t.width*=e,t.height*=e,t.x*=e,t.y*=e;const s=this.gl.canvas.width,n=this.gl.canvas.height,i=s/n,r=scrollX*e,a=scrollY*e,o=t.height/n,h=o*t.width/t.height;this.planeW=h,this.planeH=o,this.mesh.position.set(-.5*i+(t.x+r)/n+h/2,.5-(t.y+a)/n-o/2,this.zPosition),this.mesh.scale.set(h,o),this.s=this.mesh.scale.clone(),this.program.uniforms.planeW.value=h,this.program.uniforms.planeH.value=o,this.program.uniforms.planeX.value=this.mesh.position.x,this.program.uniforms.planeY.value=this.mesh.position.y,this.animations.in&&this.passes.fade&&(this.passes.fade.uniforms.planeW.value=this.program.uniforms.planeW.value,this.passes.fade.uniforms.planeH.value=this.program.uniforms.planeH.value,this.passes.fade.uniforms.planeX.value=this.program.uniforms.planeX.value,this.passes.fade.uniforms.planeY.value=this.program.uniforms.planeY.value),this.pos={x:this.mesh.position.x,y:this.mesh.position.y,z:this.mesh.position.z}}isInViewport(t){return t.top>=-t.height&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)+t.height}isCenterInViewport(t){return t.top+t.height/2>=0&&t.bottom-t.height/2<=(window.innerHeight||document.documentElement.clientHeight)}updateVisibility(){const t=this.domElement.getBoundingClientRect(),e=this.isInViewport(t),s=this.isCenterInViewport(t);e&&this.enabled?(this.visible||this.post.passes.forEach((function(t){t.enabled=!0})),this.visible=!0,this.mesh.visible=!0,this.animatedIn||(s?this.animeIn():(this.visible=!1,this.mesh.visible=!1))):(this.visible&&this.post.passes.forEach((function(t){t.enabled=!1})),this.visible=!1,this.mesh.visible=!1)}updateOffset(t,e){this.offsetX=t,this.offsetY=e;const s=this.gl.canvas.width/this.gl.canvas.height;this.mesh.position.x=this.pos.x-s*t,this.mesh.position.y=this.pos.y+e,this.p=this.mesh.position.clone(),this.meshPosition={x:this.pos.x-s*t,y:this.pos.y+e,z:this.pos.z},this.program.uniforms.planeX.value=this.mesh.position.x,this.program.uniforms.planeY.value=this.mesh.position.y,this.updateVisibility()}onResize(){this.update()}updateUniformsFromAnimationParams(){const t=this,e=(this.animations,this.getInParam("progress")),s=this.program.uniforms.progress.value;this.program.uniforms.progress.value=e;const n=this.program.uniforms.progress.value-s;this.program.uniforms.progress.value<1||this.options.mouse.flowmap.enabled?(this.post.passes.forEach((function(s){s.enabled&&(s.uniforms.hasOwnProperty("u_time")&&(s.uniforms.u_time.value+=.02),s.uniforms.hasOwnProperty("u_radius")&&(s.uniforms.u_radius.value=e*(Math.pow(2,.5)/2)*1.2),s.uniforms.hasOwnProperty("strength")&&(s.uniforms.strength.value=1-e),s.uniforms.hasOwnProperty("progress")&&(s.uniforms.progress.value=e),s.uniforms.hasOwnProperty("speed")&&(s.uniforms.speed.value=n),s.uniforms.hasOwnProperty("threshold")&&(s.uniforms.threshold.value=t.options.in.fade.threshold),s.uniforms.hasOwnProperty("alphaMapAngle")&&(s.uniforms.alphaMapAngle.value=t.options.in.fade.alphaMapAngle))})),this.program.uniforms.strength.value=1-e,this.program.uniforms.translate.value.x=this.options.in.translate.x,this.program.uniforms.translate.value.y=this.options.in.translate.y,this.program.uniforms.translate.value.z=this.options.in.translate.z,this.program.uniforms.rotate.value.x=Math.PI*this.options.in.rotate.x/180,this.program.uniforms.rotate.value.y=Math.PI*this.options.in.rotate.y/180,this.program.uniforms.rotate.value.z=Math.PI*this.options.in.rotate.z/180,this.program.uniforms.p1.value.x=this.options.in.corners.start1,this.program.uniforms.p2.value.x=this.options.in.corners.start2,this.program.uniforms.p3.value.x=this.options.in.corners.start3,this.program.uniforms.p4.value.x=this.options.in.corners.start4,this.program.uniforms.p1.value.y=this.options.in.corners.end1,this.program.uniforms.p2.value.y=this.options.in.corners.end2,this.program.uniforms.p3.value.y=this.options.in.corners.end3,this.program.uniforms.p4.value.y=this.options.in.corners.end4,this.program.uniforms.easeX.value=this.options.in.corners.easeX,this.program.uniforms.easeY.value=this.options.in.corners.easeY):this.disable()}getInParam(t){return this.options.in.live?this.options.in[t]:this.animations.in.params[t]}updateMeshPosition(){this.animationParams.translateY=0,this.animations.in&&this.animations.in.params.progress<1||this.options.in.live,this.mesh.position.set(this.meshPosition.x+this.animationParams.translateX,this.meshPosition.y+this.animationParams.translateY,this.meshPosition.z+this.animationParams.translateZ)}updateMeshVelocity(){this.timeNow=performance.now(),this.deltaTime=this.timeNow-this.timeOld,this.timeOld=this.timeNow;const t=1-this.getInParam("progress");this.meshTranslateOld&&(this.meshVelocity={x:(this.options.in.translate.x*t-this.meshTranslateOld.x)/this.deltaTime,y:(this.options.in.translate.y*t-this.meshTranslateOld.y)/this.deltaTime,z:(this.options.in.translate.z*t-this.meshTranslateOld.z)/this.deltaTime},this.meshVelocityLerp={x:ce(this.meshVelocityLerp.x,this.meshVelocity.x,.2),y:ce(this.meshVelocityLerp.y,this.meshVelocity.y,.2),z:ce(this.meshVelocityLerp.z,this.meshVelocity.z,.2)}),this.meshTranslateOld={x:this.options.in.translate.x*t,y:this.options.in.translate.y*t,z:this.options.in.translate.z*t}}updateActivePasses(){for(let t in this.passes)this.options.in[t]&&(this.passes[t].enabled=this.options.in[t].enabled)}enable(){this.enabled||(this.enabled=!0,this.updateVisibility(),this.update(),this.updateOffset(this.offsetX,this.offsetY),this.domElement.style.visibility="hidden")}disable(){if(this.enabled){const t=this;this.isImage?setTimeout((function(){t.enabled=!1,t.updateVisibility()}),100):(t.enabled=!1,t.updateVisibility()),this.domElement.style.visibility="visible",this.originalDomElement.style.visibility="visible"}}render(t,e){this.visible&&this.enabled&&(this.animations.scroll&&this.animations.scroll.render(t),this.animations.in&&this.animations.in.render(),this.updateActivePasses(),this.updateUniformsFromAnimationParams(),this.updateMeshPosition(),this.post.render({texture:this.texture}),this.mesh.program.uniforms.tMap.value=this.post.uniform.value,this.options.mouse.hover.enabled&&(this.hover?(this.mesh.position.z=ce(this.mesh.position.z,this.options.mouse.hover.zoom+this.zPosition,this.options.mouse.hover.ease),this.mesh.rotation.x=ce(this.mesh.rotation.x,this.options.mouse.hover.rotate*(.5-this.mouseY),this.options.mouse.hover.ease),this.mesh.rotation.y=ce(this.mesh.rotation.y,this.options.mouse.hover.rotate*(.5-this.mouseX),this.options.mouse.hover.ease),this.mesh.scale.x=ce(this.mesh.scale.x,this.s.x*this.options.mouse.hover.scale,this.options.mouse.hover.ease),this.mesh.scale.y=ce(this.mesh.scale.y,this.s.y*this.options.mouse.hover.scale,this.options.mouse.hover.ease)):(this.mesh.position.z=ce(this.mesh.position.z,this.zPosition,this.options.mouse.hover.ease),this.mesh.rotation.x=ce(this.mesh.rotation.x,0,this.options.mouse.hover.ease),this.mesh.rotation.y=ce(this.mesh.rotation.y,0,this.options.mouse.hover.ease),this.mesh.scale.x=ce(this.mesh.scale.x,this.s.x,this.options.mouse.hover.ease),this.mesh.scale.y=ce(this.mesh.scale.y,this.s.y,this.options.mouse.hover.ease))))}}class me{constructor(t,e,s,n){this.selector=e,this.options=t;const i=new b({alpha:!0,dpr:window.devicePixelRatio,premultipliedAlpha:!0,preserveDrawingBuffer:!0,preserveDrawingBuffer:!1,depth:!0}),r=i.gl;this.gl=r,this.renderer=i,r.clearColor(0,0,0,0),document.body.appendChild(r.canvas),r.canvas.style.position="absolute",r.canvas.style.top="0",r.canvas.style.left="0",r.canvas.style.zIndex=s,r.canvas.style.pointerEvents="none";const o=t.in.cameraFov,h=new D(r,{fov:o});window.camera=h,this.camera=h;let l=o*Math.PI/180,u=1/(2*Math.tan(l/2));window.addEventListener("agl-update",(function(){l=t.in.cameraFov*Math.PI/180,u=1/(2*Math.tan(l/2)),h.fov=t.in.cameraFov,h.perspective(),h.position.z=u})),h.position.set(0,0,u),h.lookAt([0,0,0]);const c=new R;this.scene=c,this.planes=[];const p=new st(r),d=new st(r,{dpr:.5,targetOnly:!0});this.postComposite=p,this.postBloom=d;const f={value:new a};this.resolution=f;const m={value:new a};this.bloomResolution=m,this.flowmap=n||new rt(r,{size:64,falloff:.2,alpha:.2,dissipation:.9,type:r.HALF_FLOAT});const g=p.addPass({fragment:"\n\nprecision highp float;\nuniform sampler2D tMap;\nuniform sampler2D tBloom;\nuniform vec2 uResolution;\nuniform float uBloomStrength;\nvarying vec2 vUv;\nvoid main() {\n    // // gl_FragColor = texture2D(tMap, vUv) + texture2D(tBloom, vUv) * uBloomStrength;\n    // if(uBloomStrength > 0.01)\n    //     gl_FragColor = texture2D(tMap, vUv) + texture2D(tBloom, vUv) * uBloomStrength;\n    //     // gl_FragColor = texture2D(tBloom, vUv);\n    // else{\n    //     gl_FragColor = texture2D(tMap, vUv);\n    // }\n\n    gl_FragColor = texture2D(tMap, vUv);\n}\n\n",uniforms:{uResolution:f,tBloom:d.uniform,uBloomStrength:{value:1}}});this.compositePass=g;const y=p.addPass({fragment:"\n\n// precision highp float;\nprecision mediump float;\n\nuniform sampler2D tMap;\nuniform sampler2D tFlow;\nuniform float rgbSplit;\nuniform float time;\nuniform vec3 water;\n// uniform float uTime;\nvarying vec2 vUv;\n\n#define NUM_OCTAVES 5\n\nfloat rand(vec2 n) { \n\treturn fract(sin(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\n}\n\nfloat noise(vec2 p){\n\tvec2 ip = floor(p);\n\tvec2 u = fract(p);\n\tu = u*u*(3.0-2.0*u);\n\t\n\tfloat res = mix(\n\t\tmix(rand(ip),rand(ip+vec2(1.0,0.0)),u.x),\n\t\tmix(rand(ip+vec2(0.0,1.0)),rand(ip+vec2(1.0,1.0)),u.x),u.y);\n\treturn res*res;\n}\n\nfloat fbm(vec2 x, float ang) {\n\tfloat v = .25;\n\tfloat a = 0.5;\n\tvec2 shift = vec2(100);\n    float angle = .25;\n\t// Rotate to reduce axial bias\n    mat2 rot = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));\n\tfor (int i = 0; i < NUM_OCTAVES; ++i) {\n\t\tv += a * noise(x);\n\t\tx = rot * x * 2.0 + shift;\n\t\ta *= 0.5;\n\t}\n\treturn v;\n}\n\n\n\n\nvoid main() {\n    vec2 uv = vUv;\n\n    // R and G values are velocity in the x and y direction\n    // B value is the velocity length\n    vec3 flow = texture2D(tFlow, vUv).rgb;\n\n    float threshold = .01;\n\n    if(flow.z > threshold) {\n            \n        float strength = water.x + flow.z;\n\n        if(water.x > 0.){\n\n            // water distorsion\n            strength *= flow.z;\n            // vec2 surface = flow.b * vec2(mix(-.3, .3, fbm(10. * uv + .5 * time, time / 20.)));\n            vec2 surface = strength  * vec2(mix(-.3, .3, fbm(10. * water.y * uv + .3 * time, time / 10.)));\n            // vec2 surface = strength * vec2(mix(-t1, t1, fbm(t2 * uv + t3 * time, time / t4)));\n            // vec2 modified = refract(vec2(0.), surface, 1. / 1.3333);\n            uv += refract(vec2(0.), surface, 1. / 1.3333);\n            // vec4 noise = vec4(vec3(surface.y), 1.);\n        }else{\n\n            // 2D pull distorsion \n            uv -= flow.z * (flow.xy) * .2;\n        }\n\n    }\n\n    // RGB split\n    vec4 c1 = texture2D(tMap, uv);\n\n    // // debug - show flow map \n    // if(flow.z > threshold)\n    //     c1.r = 1.;\n\n        \n    if(rgbSplit > 0. && flow.z > threshold){\n        uv -= flow.z * (flow.xy) * rgbSplit;\n        vec4 c2 = texture2D(tMap, uv);\n        gl_FragColor = vec4(c1.r, c2.gba);\n    }else{\n        gl_FragColor = c1;\n    }\n    \n}\n\n",uniforms:{tFlow:{value:this.flowmap.uniform.value},rgbSplit:{value:.1},time:{value:0},water:{value:new v}}});this.flowPass=y,this.createPlanes(),window.addEventListener("click",(function(t){})),window.addEventListener("agl-init",this.createPlanes.bind(this))}createPlanes(){let t;this.flowmap;const e=this.gl,s=this.scene,n=this.options,i=this.planes;this.elements=document.querySelectorAll(this.selector),this.elements.forEach((function(r,a){r.plane||(t=new fe(e,{domElement:r,index:a,options:n}),t.mesh.setParent(s),i.push(t),r.plane=t,r.addEventListener("agl-remove",(function(t){this.plane&&(this.plane.mesh.setParent(null),this.plane=null,i.splice(i.indexOf(this.plane),1))})))}));const r=window.innerHeight,a=document.documentElement.clientWidth;this.resize(a,r)}onMouseMove(t){this.planes.forEach((function(e){e.onMouseMove(t)}))}resize(t,e){0!=this.planes.length&&(this.width=t,this.height=e,this.renderer.setSize(t,e),this.camera.perspective({aspect:this.gl.canvas.width/this.gl.canvas.height}),this.postComposite.resize(),this.postBloom.resize(),this.resolution.value.set(t,e),this.bloomResolution.value.set(this.postBloom.options.width,this.postBloom.options.height),this.onScroll())}onScroll(){if(0==this.planes.length)return;const t=this,e=Math.min(scrollX,document.body.scrollWidth),s=Math.min(scrollY,document.body.scrollHeight);this.renderer.gl.canvas.style.transform=" translate3d("+e+"px,"+s+"px, 0px)",this.planes.forEach((function(e){e.update(),e.updateOffset(scrollX/window.innerWidth,scrollY/t.height)}))}render(t,e,s,n,i,r){0!=this.planes.length&&(this.flowmap.aspect=1,this.flowmap.mouse.copy(n),this.flowmap.velocity.lerp(i,i.len?.2:.1),this.flowmap.update(),this.compositePass.uniforms.uBloomStrength.value=.002*r,this.planes.forEach((function(r){r.render((e-s)/1e3,t,n,i)})),this.compositePass.enabled=!1,this.flowPass.enabled=!1,this.postComposite.targetOnly=!0,this.postComposite.render({scene:this.scene,camera:this.camera}),this.compositePass.enabled=!0,this.options.mouse.flowmap.enabled&&(this.flowPass.enabled=!0,this.flowmap.mesh.program.uniforms.uAlpha.value=this.options.mouse.flowmap.strength,this.flowmap.mesh.program.uniforms.uFalloff.value=this.options.mouse.flowmap.size,this.flowmap.mesh.program.uniforms.uDissipation.value=1-this.options.mouse.flowmap.ease,this.flowPass.uniforms.rgbSplit.value=this.options.mouse.flowmap.rgbSplit),this.options.mouse.water.enabled?(this.flowPass.enabled=!0,this.flowPass.uniforms.time.value=this.options.mouse.water.speed*t/100,this.flowPass.uniforms.water.value.x=r/1e4||this.options.mouse.flowmap.strength,this.flowPass.uniforms.water.value.y=this.options.mouse.flowmap.size):this.flowPass.uniforms.water.value.x=0,this.postComposite.targetOnly=!1,this.postComposite.render({texture:this.postComposite.uniform.value}))}}return window.AnimateGL=class{constructor(){const t={rootFolder:"../",in:{name:"",easing:"easeOutSine",ease:.1,opacity:0,duration:1e3,delay:0,angle:0,cameraFov:30,displacement:{strength:0},curl:{radius:.2,strength:0},bend:{strength:0},fade:{enabled:!0,threshold:1,type:"right",alphaMapSrc:null},liquid:{enabled:!1},translate:{enabled:!1,x:0,y:0,z:0},rotate:{enabled:!1,x:0,y:0,z:0},corners:{enabled:!0,start1:0,start2:0,start3:0,start4:0,end1:1,end2:1,end3:1,end4:1,easeX:1,easeY:1},presets:{bendLeft:{fade:{type:"basic"},translate:{x:.3},corners:{end1:.9,end2:.9,easeY:3}},bendRight:{fade:{type:"basic"},translate:{x:-.3},corners:{end1:.9,end2:.9,easeY:3}},bendUp:{fade:{type:"basic"},translate:{y:-.3},corners:{end1:.9,end3:.9,easeX:3}},bendDown:{fade:{type:"basic"},translate:{y:.3},corners:{end1:.9,end3:.9,easeX:3}},fadeLeft:{fade:{type:"left"}},fadeRight:{fade:{type:"right"}},fadeUp:{fade:{type:"up"}},fadeDown:{fade:{type:"down"}},peelLeft:{fade:{type:"basic"},translate:{x:1,z:.7},rotate:{y:180},corners:{end2:.5,end4:.6,end1:.9,easeX:2}},peelRight:{fade:{type:"basic"},translate:{x:-1,z:.7},rotate:{y:-180},corners:{end1:.5,end3:.6,end2:.9,easeX:1}},peelUp:{fade:{type:"basic"},translate:{y:-1,z:.7},rotate:{x:-180},corners:{end1:.5,end2:.6,end3:.9,easeY:1}},peelDown:{fade:{type:"basic"},translate:{y:1,z:.7},rotate:{x:-180},corners:{end1:.9,end3:.5,end4:.6,easeY:2}},flipUp:{fade:{type:"basic"},rotate:{x:-120},corners:{start1:.4,start2:.5,start3:0,start4:.1,end1:.9,end2:1,end3:.5,end4:.6,easeX:4,easeY:4}},flipDown:{fade:{type:"basic"},rotate:{x:120},corners:{start2:.1,start3:.4,start4:.5,end1:.5,end2:.6,end3:.9}},flipLeft:{fade:{type:"basic"},rotate:{y:120},corners:{start2:.4,start3:.1,start4:.5,end1:.5,end2:.9,end3:.6}},flipRight:{fade:{type:"basic"},rotate:{y:-120},corners:{start2:.4,start3:.1,start4:.5,end1:.5,end2:.9,end3:.6}},fadeBasic:{fade:{type:"basic"}},slideLeft:{fade:{type:"right"},translate:{x:.3}},slideRight:{fade:{type:"left"},translate:{x:-.3}},slideUp:{fade:{type:"down"},translate:{y:-.3}},slideDown:{fade:{type:"up"},translate:{y:.3}},stretchLeft:{fade:{type:"basic"},translate:{x:.3},corners:{start2:.2,start4:.2,end1:.9,end3:.9,easeX:1}},stretchRight:{fade:{type:"basic"},translate:{x:-.3},corners:{start1:.2,start3:.2,end2:.9,end4:.9,easeX:2}},stretchDown:{fade:{type:"basic"},translate:{y:.3},corners:{start3:.2,start4:.2,end1:.9,end2:.9,easeY:1}},stretchUp:{fade:{type:"basic"},translate:{y:-.3},corners:{start1:.2,start2:.2,end3:.9,end4:.9,easeY:2}},wipeLeft:{fade:{type:"left",threshold:0}},wipeRight:{fade:{type:"right",threshold:0}},wipeUp:{fade:{type:"up",threshold:0}},wipeDown:{fade:{type:"down",threshold:0}},zoomInLeft:{fade:{type:"right"},translate:{z:-1,x:.5},rotate:{y:-10}},zoomInRight:{fade:{type:"left"},translate:{z:-1,x:-.5},rotate:{y:10}},zoomInUp:{fade:{type:"down"},translate:{z:-1,y:-.5},rotate:{x:10}},zoomInDown:{fade:{type:"up"},translate:{z:-1,y:.5},rotate:{x:-10}}}},mouse:{flowmap:{enabled:!1,size:.2,strength:.2,ease:.2,rgbSplit:.2},water:{enabled:!1,speed:.5,strength:1,size:.5},rotate:{enabled:!1,ease:.25,inertia:.85},hover:{enabled:!1,rotate:.5,zoom:0,scale:1.2,ease:.1}},scroll:{bend:{enabled:!1,radius:.2,strength:0},fisheye:{enabled:!1,strength:0},stretch:{strength:0},displacement:{strength:0},rgbShift:{strength:0},ease:.1}};window.agl={defaults:t};const e=ue({},t,arguments[0]);this.options=e;const s=new a(-1),n=new a,i=new a;let r,o=0,h=0,l=0;const u=[],c=new me(this.options,".agl",999);function p(t){t.changedTouches&&t.changedTouches.length&&(t.x=t.changedTouches[0].pageX,t.y=t.changedTouches[0].pageY),void 0===t.x&&(t.x=t.pageX,t.y=t.pageY),s.set(t.x/d,1-t.y/f),r||(r=performance.now(),i.set(t.x,t.y));const e=t.x-i.x,a=t.y-i.y;i.set(t.x,t.y);let o=performance.now(),h=Math.max(14,o-r);r=o,n.x=e/h,n.y=a/h,n.needsUpdate=!0,u.forEach((function(e){e.onMouseMove(t)}))}let d,f,m;function g(){f=window.innerHeight,d=document.documentElement.clientWidth,u.forEach((function(t){t.resize(d,f)}))}function v(){u.forEach((function(t){t.onScroll()}))}u.push(c),new MutationObserver((function(t){t.forEach((function(t){if("class"===t.attributeName){var e=t.target;e.classList.contains("agl")?e.plane?e.plane.cssClassUpdated():window.dispatchEvent(new Event("agl-init")):e.plane&&e.plane.disable()}}))})).observe(document.body,{attributes:!0,attributeFilter:["class"],childList:!0,subtree:!0}),"ontouchstart"in window?(window.addEventListener("touchstart",p,!1),window.addEventListener("touchmove",p,!1)):window.addEventListener("mousemove",p,!1),requestAnimationFrame((function t(i){n.needsUpdate||(s.set(-1),n.set(0)),n.needsUpdate=!1,h=window.scrollY,o=ce(o,h,e.scroll.ease),l=Math.abs(h-o),u.forEach((function(t){t.render(i,h,o,s,n,l)})),requestAnimationFrame(t)})),g(),window.addEventListener("resize",(function(){clearTimeout(m),m=setTimeout(g,100)}),!1),new ResizeObserver((t=>{for(const e of t)clearTimeout(m),m=setTimeout(g,100)})).observe(document.querySelector("body")),window.addEventListener("scroll",v),window.addEventListener("wheel",v),"ontouchmove"in window&&window.addEventListener("touchmove",v)}update(){console.log("update")}},t})()}));